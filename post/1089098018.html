<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><meta name="generator" content="Hexo 3.9.0"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><title>Node.js + Express + mongodb 的博客项目之前端ejs模块化及博客分类管理、分页功能实现（六） - 枫林晚记</title><meta name="description" content="前言模块化开发，主要是以提高代码的复用性，可维护性等。再这个博客项目中，到处体现有模块化开发的思想，如使用 MVC 的设计模式，路由的分文件处理等。在 ejs 模板引擎中，类似 jsp 一般可以将里面的各个内容分成不同的模块，然后再分别引入相关模块组成页面，这样一来就可以做到了代码的复用性，同时维护起来的成本也降低。"><meta name="keywords" content="Node.js,实战,Express"><meta property="og:type" content="article"><meta property="og:title" content="Node.js + Express + mongodb 的博客项目之前端ejs模块化及博客分类管理、分页功能实现（六）"><meta property="og:url" content="https://tflin.com/post/1089098018.html"><meta property="og:site_name" content="枫林晚记"><meta property="og:description" content="前言模块化开发，主要是以提高代码的复用性，可维护性等。再这个博客项目中，到处体现有模块化开发的思想，如使用 MVC 的设计模式，路由的分文件处理等。在 ejs 模板引擎中，类似 jsp 一般可以将里面的各个内容分成不同的模块，然后再分别引入相关模块组成页面，这样一来就可以做到了代码的复用性，同时维护起来的成本也降低。"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://tflin.com/images/og_image.png"><meta property="og:updated_time" content="2021-06-23T02:15:29.742Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Node.js + Express + mongodb 的博客项目之前端ejs模块化及博客分类管理、分页功能实现（六）"><meta name="twitter:description" content="前言模块化开发，主要是以提高代码的复用性，可维护性等。再这个博客项目中，到处体现有模块化开发的思想，如使用 MVC 的设计模式，路由的分文件处理等。在 ejs 模板引擎中，类似 jsp 一般可以将里面的各个内容分成不同的模块，然后再分别引入相关模块组成页面，这样一来就可以做到了代码的复用性，同时维护起来的成本也降低。"><meta name="twitter:image" content="https://tflin.com/images/og_image.png"><link rel="icon" href="/images/favicon.svg"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css"><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/5.4.1/css/all.min.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css"><link rel="stylesheet" href="/css/back-to-top.css"><link rel="stylesheet" href="/css/progressbar.css"><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><link rel="stylesheet" href="/css/style.css"><meta name="referrer" content="no-referrer"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand is-flex-center"><a class="navbar-item navbar-logo" href="/"><img src="/images/logo.png" alt="Node.js + Express + mongodb 的博客项目之前端ejs模块化及博客分类管理、分页功能实现（六）" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" target="_self" href="/">首页</a> <a class="navbar-item" target="_self" href="/archives/">归档</a> <a class="navbar-item" target="_self" href="/categories/">分类</a> <a class="navbar-item" target="_self" href="/tags/">标签</a> <a class="navbar-item" target="_self" href="/chitchat/">闲言</a> <a class="navbar-item" target="_self" href="/about/">关于</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" title="Download on GitHub" href="https://github.com/tflins"><i class="fab fa-github"></i> </a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i> </a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column is-8-tablet is-8-desktop is-9-widescreen has-order-2 column-main"><div class="card"><div class="card-content article"><h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal"><i class="fas fa-angle-double-right"></i>Node.js + Express + mongodb 的博客项目之前端ejs模块化及博客分类管理、分页功能实现（六）</h1><div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto"><div class="level-left"><time class="level-item has-text-grey" datetime="2018-07-31T04:33:05.000Z"><i class="far fa-calendar-alt">&nbsp;</i>2018-07-31</time> <time class="level-item has-text-grey is-hidden-mobile" datetime="2021-06-23T02:15:29.742Z"><i class="far fa-calendar-check">&nbsp;</i>2021-06-23</time><div class="level-item"><a class="has-link-grey -link" href="/categories/后端/">后端</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/后端/Node-js/">Node.js</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/后端/Node-js/博客实战系列/">博客实战系列</a></div><span class="level-item has-text-grey">21 分钟 读完 (大约 3126 个字)</span></div></div><div class="content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>模块化开发，主要是以提高代码的复用性，可维护性等。再这个博客项目中，到处体现有模块化开发的思想，如使用 MVC 的设计模式，路由的分文件处理等。在 ejs 模板引擎中，类似 jsp 一般可以将里面的各个内容分成不同的模块，然后再分别引入相关模块组成页面，这样一来就可以做到了代码的复用性，同时维护起来的成本也降低。</p><hr><a id="more"></a><h2 id="ejs-模板引擎的模块化"><a href="#ejs-模板引擎的模块化" class="headerlink" title="ejs 模板引擎的模块化"></a>ejs 模板引擎的模块化</h2><p>在 /views/admin 中新建一个名为 header.ejs 的模板，当做后台管理的页头，将 /views/admin/index.ejs 的导航部分剪切出来放到 header.ejs 中，header.ejs 代码如下：<br></p><figure class="highlight html hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span>&gt;</span></span><br><span class="line">  <span class="hljs-comment">&lt;!--引用bootstrap样式--&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/public/css/bootstrap.min.css"</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>控制台<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">header</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">nav</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar navbar-default navbar-inverse"</span>&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container-fluid"</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar-header"</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar-brand"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/admin"</span>&gt;</span>后台管理<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav navbar-nav"</span>&gt;</span></span><br><span class="line">                <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/admin/user"</span>&gt;</span>用户管理<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="line">                <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dropdown"</span>&gt;</span></span><br><span class="line">                  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dropdown-toggle"</span> <span class="hljs-attr">data-toggle</span>=<span class="hljs-string">"dropdown"</span>&gt;</span></span><br><span class="line">                      分类管理</span><br><span class="line">                      <span class="hljs-tag">&lt;<span class="hljs-name">b</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"caret"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span></span><br><span class="line">                  <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="line">                  <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dropdown-menu"</span>&gt;</span></span><br><span class="line">                      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/admin/category"</span>&gt;</span>分类首页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="line">                      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/admin/category/add"</span>&gt;</span>添加分类<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="line">                  <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span><br><span class="line">                <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="line">                <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dropdown"</span>&gt;</span></span><br><span class="line">                  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dropdown-toggle"</span> <span class="hljs-attr">data-toggle</span>=<span class="hljs-string">"dropdown"</span>&gt;</span></span><br><span class="line">                      内容管理</span><br><span class="line">                      <span class="hljs-tag">&lt;<span class="hljs-name">b</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"caret"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span></span><br><span class="line">                  <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="line">                  <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dropdown-menu"</span>&gt;</span></span><br><span class="line">                      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/admin/content"</span>&gt;</span>内容首页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="line">                      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/admin/content/add"</span>&gt;</span>添加内容<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="line">                  <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span><br><span class="line">                <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav navbar-nav pull-right"</span>&gt;</span></span><br><span class="line">              <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dropdown"</span>&gt;</span></span><br><span class="line">                  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dropdown-toggle"</span> <span class="hljs-attr">data-toggle</span>=<span class="hljs-string">"dropdown"</span>&gt;</span></span><br><span class="line">                    <span class="hljs-tag">&lt;<span class="hljs-name">%=userInfo.username%</span>&gt;</span></span><br><span class="line">                    <span class="hljs-tag">&lt;<span class="hljs-name">b</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"caret"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span></span><br><span class="line">                  <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="line">                  <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dropdown-menu"</span>&gt;</span></span><br><span class="line">                      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/"</span>&gt;</span>返回主页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="line">                      <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"divider"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="line">                      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"javascript:;"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"logout"</span>&gt;</span>退出<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="line">                  <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span><br><span class="line">              <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/public/js/3.3.1-jquery-min.js"</span>&gt;</span><span class="hljs-undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/public/js/bootstrap.min.js"</span>&gt;</span><span class="hljs-undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="hljs-undefined"></span></span><br><span class="line"><span class="hljs-javascript">        <span class="hljs-comment">// 管理员登出</span></span></span><br><span class="line"><span class="hljs-javascript">      $(<span class="hljs-string">"#logout"</span>).on(<span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;</span></span><br><span class="line"><span class="hljs-javascript">        $.ajax(&#123;</span></span><br><span class="line"><span class="hljs-javascript">                url: <span class="hljs-string">"/api/user/logout"</span>,</span></span><br><span class="line"><span class="hljs-javascript">                success: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">result</span>) </span>&#123;</span></span><br><span class="line"><span class="hljs-javascript">                    <span class="hljs-keyword">if</span> (result) &#123;</span></span><br><span class="line"><span class="hljs-javascript">                        <span class="hljs-built_in">window</span>.location = <span class="hljs-string">"http://localhost:8080/"</span>;</span></span><br><span class="line"><span class="hljs-undefined">                    &#125;</span></span><br><span class="line"><span class="hljs-undefined">                &#125;</span></span><br><span class="line"><span class="hljs-undefined">            &#125;);</span></span><br><span class="line"><span class="hljs-undefined">      &#125;);</span></span><br><span class="line"><span class="hljs-undefined">  </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>然后在后台首页界面中引用 header.ejs 模板：<br></p><figure class="highlight html hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">&lt;!-- 引用页头文件 --&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">%-</span> <span class="hljs-attr">include</span>("<span class="hljs-attr">header</span>") %&gt;</span></span><br><span class="line"> <span class="hljs-comment">&lt;!-- 以前的内容在下面 --&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>同时用户管理页面将 header 标签的内容删掉后引入 header.ejs：<br></p><figure class="highlight html hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">&lt;!-- 引用页头文件 --&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">%-</span> <span class="hljs-attr">include</span>("<span class="hljs-attr">..</span>/<span class="hljs-attr">header</span>") %&gt;</span></span><br><span class="line"><span class="hljs-comment">&lt;!-- 以前的内容在下面 --&gt;</span></span><br></pre></td></tr></table></figure><p></p><hr><h2 id="内容显示分页的实现"><a href="#内容显示分页的实现" class="headerlink" title="内容显示分页的实现"></a>内容显示分页的实现</h2><p>分页功能是数据展示必备的功能，如果需要查询 1000 条数据，一次性的进行展示不仅浪费用户等待的时间，宽带，而且还占用服务器的 I/O 时间从而影响性能，用户一次性看到这么多的数据也很头疼，用户体验不好。所以就需要分页功能来展示数据，就像看书一样，一页展示一点数据，分页展示。</p><hr><h3 id="前端组件"><a href="#前端组件" class="headerlink" title="前端组件"></a>前端组件</h3><p>分页功能估计后面需要经常用到，所以我们就将它抽离出来分成一个组件，一个模块。在 /views/ 目录下新建一个模板文件 pagination.ejs 当做分页组件，代码如下：<br></p><figure class="highlight html hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">nav</span> <span class="hljs-attr">aria-label</span>=<span class="hljs-string">"..."</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"pager"</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/admin/user?page=&lt;%=page-1%&gt;"</span>&gt;</span>上一页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span></span><br><span class="line">    一共有 <span class="hljs-tag">&lt;<span class="hljs-name">%=count%</span>&gt;</span> 条数据，每页显示 <span class="hljs-tag">&lt;<span class="hljs-name">%=limit%</span>&gt;</span> 条数据，当前第 <span class="hljs-tag">&lt;<span class="hljs-name">%=page%</span>&gt;</span>/<span class="hljs-tag">&lt;<span class="hljs-name">%=pages%</span>&gt;</span> 页</span><br><span class="line">  <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"&lt;%=url%&gt;?page=&lt;%=page+1%&gt;"</span>&gt;</span>下一页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><hr><h3 id="后端模块"><a href="#后端模块" class="headerlink" title="后端模块"></a>后端模块</h3><p>前端通过 GET 的方式向后端提交当前所在的页数，后端进行相应的相应。在 mongoose 中，可以通过 skip() 跳过需要查询的数据条数，limit() 每次查询几条数据，sort() 排序，等方法进行相应的组合达到分页的效果。<br>同样，分页功能以后会在很多地方使用，所以将其写成一个独立的模块，以便以后重复的使用。在项目的根目录下新建一个目录 my_modules 用来存放我们自己编写的相应模块，在该目录下新建一个 pagination.js 文件，添加如下代码：<br></p><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/*</span></span><br><span class="line"><span class="hljs-comment">    自定义分页渲染模块</span></span><br><span class="line"><span class="hljs-comment">        需要传递一个对象进来，该对象的属性包括：</span></span><br><span class="line"><span class="hljs-comment">        pagination = &#123;</span></span><br><span class="line"><span class="hljs-comment">        // 每页显示的条数</span></span><br><span class="line"><span class="hljs-comment">        limit: 10,</span></span><br><span class="line"><span class="hljs-comment">        // 需要操作的数据库模型</span></span><br><span class="line"><span class="hljs-comment">        model: userModel,</span></span><br><span class="line"><span class="hljs-comment">        // 需要控制分页的url</span></span><br><span class="line"><span class="hljs-comment">        url: "/admin/user",</span></span><br><span class="line"><span class="hljs-comment">        // 渲染的模板页面</span></span><br><span class="line"><span class="hljs-comment">        ejs: "admin/user",</span></span><br><span class="line"><span class="hljs-comment">        res: res,</span></span><br><span class="line"><span class="hljs-comment">        req: req,</span></span><br><span class="line"><span class="hljs-comment">        // 查询的条件</span></span><br><span class="line"><span class="hljs-comment">        where: &#123;&#125;,</span></span><br><span class="line"><span class="hljs-comment">        // 联合查询的条件</span></span><br><span class="line"><span class="hljs-comment">        populate: []</span></span><br><span class="line"><span class="hljs-comment">        // 名称</span></span><br><span class="line"><span class="hljs-comment">        docs</span></span><br><span class="line"><span class="hljs-comment">    &#125;</span></span><br><span class="line"><span class="hljs-comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">const</span> pagination = <span class="hljs-function">(<span class="hljs-params">object</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-comment">/*</span></span><br><span class="line"><span class="hljs-comment">        实现分页</span></span><br><span class="line"><span class="hljs-comment">            limit(Number): 限制获取的数据条数</span></span><br><span class="line"><span class="hljs-comment">            skip(Numer): 跳过数据的条数</span></span><br><span class="line"><span class="hljs-comment">        每页显示2条</span></span><br><span class="line"><span class="hljs-comment">    */</span></span><br><span class="line">    <span class="hljs-comment">// 当前页数,使用get获取前端传递的当前页数</span></span><br><span class="line">    <span class="hljs-keyword">let</span> page = object.req.query.page || <span class="hljs-number">1</span>;</span><br><span class="line">    <span class="hljs-comment">// 每页显示数据条数默认为10</span></span><br><span class="line">    <span class="hljs-keyword">let</span> limit = object.limit || <span class="hljs-number">10</span>;</span><br><span class="line">    <span class="hljs-comment">// 总页数</span></span><br><span class="line">    <span class="hljs-keyword">let</span> pages = <span class="hljs-number">0</span>;</span><br><span class="line">    <span class="hljs-comment">// 跨集合查询的条件</span></span><br><span class="line">    <span class="hljs-keyword">let</span> populate = object.populate || [];</span><br><span class="line">    <span class="hljs-comment">// 查询该文档的数据条数</span></span><br><span class="line">    object.model.countDocuments(object.where).then(<span class="hljs-function">(<span class="hljs-params">count</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="hljs-comment">// 根据总条数计算总页数</span></span><br><span class="line">        pages = <span class="hljs-built_in">Math</span>.ceil(count / limit);</span><br><span class="line">        <span class="hljs-comment">// 限制当前页数，避免溢出</span></span><br><span class="line">        <span class="hljs-comment">// page不能超过pages</span></span><br><span class="line">        page = <span class="hljs-built_in">Math</span>.min(page, pages);</span><br><span class="line">        <span class="hljs-comment">// page不能小于1</span></span><br><span class="line">        page = <span class="hljs-built_in">Math</span>.max(page, <span class="hljs-number">1</span>);</span><br><span class="line">        <span class="hljs-comment">// 跳过数据的条数</span></span><br><span class="line">        <span class="hljs-keyword">let</span> skip = (page - <span class="hljs-number">1</span>) * limit;</span><br><span class="line">        <span class="hljs-comment">// 分页查询出数据</span></span><br><span class="line">        object.model.find(object.where).populate(populate).skip(skip).limit(limit).then(<span class="hljs-function">(<span class="hljs-params">docs</span>) =&gt;</span> &#123;</span><br><span class="line">            object.res.render(object.ejs, &#123;</span><br><span class="line">                userInfo: object.req.userInfo,</span><br><span class="line">                docs: docs,</span><br><span class="line">                page: page,</span><br><span class="line">                pages: pages,</span><br><span class="line">                limit: limit,</span><br><span class="line">                url: object.url,</span><br><span class="line">                count: count</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// 暴露给外部使用</span></span><br><span class="line"><span class="hljs-built_in">module</span>.exports = pagination;</span><br></pre></td></tr></table></figure><p></p><p>自定义的分页模块完成后，在需要调用的地方引入它。在后台管理的路由文件 admin.js 中的用户管理首页中，将其代码修改为如下代码：<br></p><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// 用户管理首页</span></span><br><span class="line">router.get(<span class="hljs-string">"/user"</span>, (req, res, next) =&gt; &#123;</span><br><span class="line">    <span class="hljs-comment">// 调用自定义的分页渲染方法</span></span><br><span class="line">    pagination(&#123;</span><br><span class="line">        <span class="hljs-comment">// 每页显示的条数</span></span><br><span class="line">        limit: <span class="hljs-number">10</span>,</span><br><span class="line">        <span class="hljs-comment">// 需要操作的数据库模型</span></span><br><span class="line">        model: userModel,</span><br><span class="line">        <span class="hljs-comment">// 需要控制分页的url</span></span><br><span class="line">        url: <span class="hljs-string">"/admin/user"</span>,</span><br><span class="line">        <span class="hljs-comment">// 渲染的模板页面</span></span><br><span class="line">        ejs: <span class="hljs-string">"admin/user"</span>,</span><br><span class="line">        <span class="hljs-comment">// 查询的条件</span></span><br><span class="line">        where: &#123;&#125;,</span><br><span class="line">        res: res,</span><br><span class="line">        req: req</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p></p><p>然后给数据库添加多添加几条用户数据，重启服务器进行进入客户端刷新进行测试：<br><img src="http://pt2js28ws.bkt.clouddn.com/node_blog_21.gif" alt="用户分页管理"><br>到此用户分页管理，暂时完成。</p><hr><h2 id="博客的分类管理"><a href="#博客的分类管理" class="headerlink" title="博客的分类管理"></a>博客的分类管理</h2><p>博客的分类管理主要是对博客的分类进行添加，修改和删除等。管理员用户在控制台进行相应的操作，服务器端则将对数据库进行相应的操作。</p><hr><h3 id="分类的数据结构"><a href="#分类的数据结构" class="headerlink" title="分类的数据结构"></a>分类的数据结构</h3><p>先创建博客文章分类在 mongodb 中的存储结构，在 schemas 中新建一个文件 categories.js 用来限制文章分类的数据结构，其代码如下：<br></p><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// 引入相关模块</span></span><br><span class="line"><span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">"mongoose"</span>);</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">/*</span></span><br><span class="line"><span class="hljs-comment">    文章分类的数据结构</span></span><br><span class="line"><span class="hljs-comment">    &#123;</span></span><br><span class="line"><span class="hljs-comment">        文章标题，字符串类型</span></span><br><span class="line"><span class="hljs-comment">    &#125;</span></span><br><span class="line"><span class="hljs-comment">*/</span></span><br><span class="line"><span class="hljs-built_in">module</span>.exports = <span class="hljs-keyword">new</span> mongoose.Schema(&#123;</span><br><span class="line">    name: <span class="hljs-built_in">String</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p></p><p>创建了分类的Schema对象后，我们通过Schema对象来创建文章分类的数据模型，通过数据模型来对数据库进行相应的操作。在 models 文件夹中新建一个 category.js 来当做文章分类的模型，在 category.js 中添加如下代码：<br></p><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// 引入mongoose模块</span></span><br><span class="line"><span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">"mongoose"</span>);</span><br><span class="line"><span class="hljs-comment">// 引入文章分类的schema</span></span><br><span class="line"><span class="hljs-keyword">const</span> categoriesSchema = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../schemas/categories"</span>);</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// 创建文章分类模型</span></span><br><span class="line"><span class="hljs-built_in">module</span>.exports = mongoose.model(<span class="hljs-string">"category"</span>, categoriesSchema);</span><br></pre></td></tr></table></figure><p></p><hr><h3 id="分类管理首页"><a href="#分类管理首页" class="headerlink" title="分类管理首页"></a>分类管理首页</h3><p>在文章分类的模型创建完毕后，就可以创建分类管理的首页了,分类管理首页的路由设计为 GET /admin/crtegory 。我们新建一个分类管理首页的视图文件，在 /views/admin 目录下，新建一个 /categroy/index.ejs 的文件，内容如下：<br></p><figure class="highlight html hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">&lt;!-- 引入页头模板 --&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">%-</span> <span class="hljs-attr">include</span>("<span class="hljs-attr">..</span>/<span class="hljs-attr">header</span>") %&gt;</span></span><br><span class="line"><span class="hljs-comment">&lt;!-- 内容 --&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container-fluid"</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">ol</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"breadcrumb"</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/admin"</span>&gt;</span>管理首页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"active"</span>&gt;</span>分类首页<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;/<span class="hljs-name">ol</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"table table-hover table-striped table-bordered"</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">thead</span>&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>ID<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>分类名称<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>操作<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;/<span class="hljs-name">thead</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">tbody</span>&gt;</span></span><br><span class="line">      &lt;%for(let i = 0, len = docs.length; i &lt; len; i++)&#123;%&gt;</span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span></span><br><span class="line">          <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">%=docs[i]._id%</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span><br><span class="line">          <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">%=docs[i].name%</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span><br><span class="line">          <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/admin/category/edit?id=&lt;%=docs[i]._id%&gt;"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-default"</span>&gt;</span>修改<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/admin/category/delete?id=&lt;%=docs[i]._id%&gt;"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-danger"</span>&gt;</span>删除<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="line">          <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;<span class="hljs-name">%&#125;%</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;/<span class="hljs-name">tbody</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line"><span class="hljs-comment">&lt;!-- 引入分页模板 --&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">%-</span> <span class="hljs-attr">include</span>("<span class="hljs-attr">..</span>/<span class="hljs-attr">..</span>/<span class="hljs-attr">pagination</span>") %&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>重启服务器刷新浏览器客户端，进入后台管理首页，点击分类管理：<br><img src="http://pt2js28ws.bkt.clouddn.com/node_blog_15.jpg" alt="分类管理首页"></p><hr><h3 id="分类管理的添加"><a href="#分类管理的添加" class="headerlink" title="分类管理的添加"></a>分类管理的添加</h3><p>新建一个文章分类添加的页面 /views/admin/category/add.ejs 并添加如下内容：<br></p><figure class="highlight html hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">&lt;!-- 引入页头模板 --&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">%-</span> <span class="hljs-attr">include</span>("<span class="hljs-attr">..</span>/<span class="hljs-attr">header</span>") %&gt;</span></span><br><span class="line"><span class="hljs-comment">&lt;!-- 内容 --&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container-fluid"</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">ol</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"breadcrumb"</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/admin"</span>&gt;</span>管理首页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/admin/category"</span>&gt;</span>分类首页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"active"</span>&gt;</span>分类添加<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;/<span class="hljs-name">ol</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"post"</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"name"</span>&gt;</span>分类名称<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"请输入分类名称"</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-primary"</span>&gt;</span>提交<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>同时在后台路由文件 routes/admin.js 中对其进行路由配置，分类添加的界面路由为 GET /admin/categorry/add 添加如下代码：<br></p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 分类添加的首页</span><br><span class="line">router.get(&quot;/category/add&quot;, (req, res, next) =&gt; &#123;</span><br><span class="line">    // 渲染分类添加模板</span><br><span class="line">    res.render(&quot;admin/category/add&quot;, &#123;</span><br><span class="line">        userInfo: req.userInfo</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p></p><p>此时，添加文章的页面已经被渲染出来了，但是我们并没有编写保存的处理。前端使用 POST 方式向服务器提交数据，在后台进行相应的验证后，若不出错则保存进入数据库中。但在此之前，我们需要一个提示的界面，以此来提示用户相应的信息。<br>在 /views/admin 中新建一个 error.ejs 和 success.ejs 分别用来提示用户操作的成功与失败。<br>error.ejs：<br></p><figure class="highlight html hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">%-</span> <span class="hljs-attr">include</span>('<span class="hljs-attr">header</span>') %&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container-fluid"</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">ol</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"breadcrumb"</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/admin"</span>&gt;</span>管理首页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"active"</span>&gt;</span>错误提示<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;/<span class="hljs-name">ol</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"panel panel-danger"</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"panel-heading"</span>&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"panel-title"</span>&gt;</span>错误提示<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"panel-body"</span>&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;<span class="hljs-name">%=message%</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"panel-footer"</span>&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;<span class="hljs-name">%if(url)&#123;%</span>&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"&lt;%=url%&gt;"</span>&gt;</span>跳转<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;<span class="hljs-name">%&#125;else&#123;%</span>&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"javascript:window.history.back();"</span>&gt;</span>返回上一步<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;<span class="hljs-name">%&#125;%</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>success.ejs:<br></p><figure class="highlight html hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">%-</span> <span class="hljs-attr">include</span>('<span class="hljs-attr">header</span>') %&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container-fluid"</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">ol</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"breadcrumb"</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/admin"</span>&gt;</span>管理首页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"active"</span>&gt;</span>成功提示<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;/<span class="hljs-name">ol</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"panel panel-success"</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"panel-heading"</span>&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"panel-title"</span>&gt;</span>成功提示<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"panel-body"</span>&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;<span class="hljs-name">%=message%</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"panel-footer"</span>&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;<span class="hljs-name">%if(url)&#123;%</span>&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"&lt;%=url%&gt;"</span>&gt;</span>跳转<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;<span class="hljs-name">%&#125;else&#123;%</span>&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"javascript:window.history.back();"</span>&gt;</span>返回上一步<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;<span class="hljs-name">%&#125;%</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>最后我们再 /routes/admin.js 中添加如下代码，对前面添加的分类数据进行保存，保存的路由为 POST /category/add ：<br></p><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// 分类的保存</span></span><br><span class="line">router.post(<span class="hljs-string">"/category/add"</span>, (req, res, next) =&gt; &#123;</span><br><span class="line">    <span class="hljs-comment">// 获取分类名称，默认为""</span></span><br><span class="line">    <span class="hljs-keyword">let</span> name = req.body.name || <span class="hljs-string">""</span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// 如果名称为空</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (name === <span class="hljs-string">""</span>) &#123;</span><br><span class="line">        <span class="hljs-comment">// 渲染一个错误提示</span></span><br><span class="line">        res.render(<span class="hljs-string">"admin/error"</span>, &#123;</span><br><span class="line">            userInfo: req.userInfo,</span><br><span class="line">            url: <span class="hljs-literal">null</span>,</span><br><span class="line">            message: <span class="hljs-string">"分类名称不能为空！"</span></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="hljs-keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-comment">// 从数据库中查询该名称是否已存在</span></span><br><span class="line">    categoryModel.findOne(&#123;<span class="hljs-attr">name</span>: name&#125;, (err, docs) =&gt; &#123;</span><br><span class="line">        <span class="hljs-comment">// 如果数库库中已存在该名称</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (docs) &#123;</span><br><span class="line">            <span class="hljs-comment">// 渲染一个错误提示</span></span><br><span class="line">            res.render(<span class="hljs-string">"admin/error"</span>, &#123;</span><br><span class="line">                userInfo: req.userInfo,</span><br><span class="line">                url: <span class="hljs-literal">null</span>,</span><br><span class="line">                message: <span class="hljs-string">"该分类名称已存在！"</span></span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="hljs-keyword">return</span>;</span><br><span class="line">        &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">            <span class="hljs-comment">// 不存在则新建一个数据</span></span><br><span class="line">            categoryModel.create(&#123;</span><br><span class="line">                name: name</span><br><span class="line">            &#125;, (err) =&gt; &#123;</span><br><span class="line">                <span class="hljs-keyword">if</span> (!err) &#123;</span><br><span class="line">                    <span class="hljs-comment">// 渲染一个错误提示</span></span><br><span class="line">                    res.render(<span class="hljs-string">"admin/success"</span>, &#123;</span><br><span class="line">                        userInfo: req.userInfo,</span><br><span class="line">                        message: <span class="hljs-string">"添加成功！"</span>,</span><br><span class="line">                        <span class="hljs-comment">// 跳转到该路由</span></span><br><span class="line">                        url: <span class="hljs-string">"/admin/category"</span></span><br><span class="line">                    &#125;);</span><br><span class="line">                    <span class="hljs-keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p></p><p>最后重启服务器进行测试：<br><img src="http://pt2js28ws.bkt.clouddn.com/node_blog_22.gif" alt="添加分类"><br>分类的添加完成。</p><hr><h3 id="分类管理的修改及删除"><a href="#分类管理的修改及删除" class="headerlink" title="分类管理的修改及删除"></a>分类管理的修改及删除</h3><p>分类的修改是通过 GET 方式将需要修改的分类提交到服务器，然后服务器渲染出其修改的界面，管理员再对该数据进行相应的修改。<br>在 /views/admin/category 目录下新建一个 ejs 模板，分类修改的界面，内容如下：<br></p><figure class="highlight html hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">&lt;!-- 引入页头模板 --&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">%-</span> <span class="hljs-attr">include</span>("<span class="hljs-attr">..</span>/<span class="hljs-attr">header</span>") %&gt;</span></span><br><span class="line"><span class="hljs-comment">&lt;!-- 内容 --&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container-fluid"</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">ol</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"breadcrumb"</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/admin"</span>&gt;</span>管理首页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/admin/category"</span>&gt;</span>分类首页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"active"</span>&gt;</span>分类修改<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;/<span class="hljs-name">ol</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"post"</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"name"</span>&gt;</span>请输入新名称<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"请输入分类名称"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"&lt;%=category.name%&gt;"</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-default"</span>&gt;</span>提交<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>接着在后台管理的路由文件 admin.js 中添加分类修改的路由 GET /admin/category/edit 处理，添加代码如下：<br></p><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// 分类的修改界面</span></span><br><span class="line">router.get(<span class="hljs-string">"/category/edit"</span>, (req, res, next) =&gt; &#123;</span><br><span class="line">    <span class="hljs-comment">// 获取用户提交过来的id</span></span><br><span class="line">    <span class="hljs-keyword">let</span> id = req.query.id || <span class="hljs-string">""</span>;</span><br><span class="line">    <span class="hljs-comment">// 根据id从数据库中查询相关数据</span></span><br><span class="line">    categoryModel.findOne(&#123;<span class="hljs-attr">_id</span>: id&#125;, (err, category) =&gt; &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (category) &#123;</span><br><span class="line">            <span class="hljs-comment">// 如何数据存在则渲染修改界面</span></span><br><span class="line">            res.render(<span class="hljs-string">"admin/category/edit"</span>, &#123;</span><br><span class="line">                userInfo: req.userInfo,</span><br><span class="line">                category: category</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">            <span class="hljs-comment">// 若不存在渲染错误提示面板</span></span><br><span class="line">            res.render(<span class="hljs-string">"admin/error"</span>, &#123;</span><br><span class="line">                userInfo: req.userInfo,</span><br><span class="line">                url: <span class="hljs-literal">null</span>,</span><br><span class="line">                message: <span class="hljs-string">"该分类不存在！"</span></span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p></p><p>修改界面的路由完成之后，我们再写分类修改的保存，修改的保存是以 POST 的方式向服务器提交数据。在 admin.js 中添加如下代码处理前端提交过来的数据进行保存：<br></p><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// 分类修改的保存</span></span><br><span class="line">router.post(<span class="hljs-string">"/category/edit"</span>, (req, res, next) =&gt; &#123;</span><br><span class="line">    <span class="hljs-comment">// 获取修改后的id及名称</span></span><br><span class="line">    <span class="hljs-keyword">let</span> id = req.query.id;</span><br><span class="line">    <span class="hljs-keyword">let</span> name = req.body.name;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// 根据id从数据库中查询相关数据</span></span><br><span class="line">    categoryModel.findById(id, (err, category) =&gt; &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (category) &#123;</span><br><span class="line">            <span class="hljs-comment">// 若数据存在</span></span><br><span class="line">            <span class="hljs-comment">// 简单验证---如果数据没修改</span></span><br><span class="line">            <span class="hljs-keyword">if</span> (name === category.name) &#123;</span><br><span class="line">                res.render(<span class="hljs-string">"admin/success"</span>, &#123;</span><br><span class="line">                    url: <span class="hljs-string">"/admin/category"</span>,</span><br><span class="line">                    userInfo: req.userInfo,</span><br><span class="line">                    message: <span class="hljs-string">"修改成功！"</span></span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="hljs-keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-comment">// 查询用户修改的分类是否与数据库中的冲突</span></span><br><span class="line">            categoryModel.findOne(&#123;</span><br><span class="line">                _id: &#123;<span class="hljs-attr">$ne</span>: id&#125;,</span><br><span class="line">                name: name</span><br><span class="line">            &#125;, (err, docs) =&gt; &#123;</span><br><span class="line">                <span class="hljs-keyword">if</span> (docs) &#123;</span><br><span class="line">                    <span class="hljs-comment">// 数据冲突</span></span><br><span class="line">                    res.render(<span class="hljs-string">"admin/error"</span>, &#123;</span><br><span class="line">                        userInfo: req.userInfo,</span><br><span class="line">                        url: <span class="hljs-literal">null</span>,</span><br><span class="line">                        message: <span class="hljs-string">"该分类已存在！"</span></span><br><span class="line">                    &#125;);</span><br><span class="line">                    <span class="hljs-keyword">return</span>;</span><br><span class="line">                &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">                    <span class="hljs-comment">// 更新数据</span></span><br><span class="line">                    categoryModel.update(&#123;<span class="hljs-attr">_id</span>: id&#125;, &#123;<span class="hljs-attr">$set</span>: &#123;<span class="hljs-attr">name</span>: name&#125;&#125;, (err) =&gt; &#123;</span><br><span class="line">                        <span class="hljs-keyword">if</span> (!err) &#123;</span><br><span class="line">                            <span class="hljs-comment">// 不出错</span></span><br><span class="line">                            res.render(<span class="hljs-string">"admin/success"</span>, &#123;</span><br><span class="line">                                userInfo: req.userInfo,</span><br><span class="line">                                url: <span class="hljs-string">"/admin/category"</span>,</span><br><span class="line">                                message: <span class="hljs-string">"修改成功！"</span></span><br><span class="line">                            &#125;);</span><br><span class="line">                            <span class="hljs-keyword">return</span>;</span><br><span class="line">                        &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">                            <span class="hljs-comment">// 出错</span></span><br><span class="line">                            res.render(<span class="hljs-string">"admin/error"</span>, &#123;</span><br><span class="line">                                userInfo: req.userInfo,</span><br><span class="line">                                url: <span class="hljs-literal">null</span>,</span><br><span class="line">                                message: <span class="hljs-string">"修改失败！"</span></span><br><span class="line">                            &#125;);</span><br><span class="line">                            <span class="hljs-keyword">return</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">            <span class="hljs-comment">// 若不存在</span></span><br><span class="line">            res.render(<span class="hljs-string">"admin/error"</span>, &#123;</span><br><span class="line">                userInfo: req.userInfo,</span><br><span class="line">                url: <span class="hljs-literal">null</span>,</span><br><span class="line">                message: <span class="hljs-string">"该分类不存在！"</span></span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="hljs-keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p></p><hr><p>分类的删除同样也是通过 GET 方式将需要删除分类的 id 提交到服务器进行数据库删除，分类删除的路由设计为 GET /admin/category/delete 。在 admin.js 添加如下代码，处理删除分类逻辑：<br></p><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// 分类的删除</span></span><br><span class="line">router.get(<span class="hljs-string">"/category/delete"</span>, (req, res, next) =&gt; &#123;</span><br><span class="line">    <span class="hljs-comment">// 获取需要删除的分类id</span></span><br><span class="line">    <span class="hljs-keyword">let</span> id = req.query.id || <span class="hljs-string">""</span>;</span><br><span class="line">    <span class="hljs-comment">// 从数据库中删除数据</span></span><br><span class="line">    categoryModel.remove(&#123;<span class="hljs-attr">_id</span>: id&#125;, (err) =&gt; &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (!err) &#123;</span><br><span class="line">            <span class="hljs-comment">// 删除成功</span></span><br><span class="line">            res.render(<span class="hljs-string">"admin/success"</span>, &#123;</span><br><span class="line">                url: <span class="hljs-string">"/admin/category"</span>,</span><br><span class="line">                userInfo: req.userInfo,</span><br><span class="line">                message: <span class="hljs-string">"删除成功！"</span></span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">            <span class="hljs-comment">// 删除失败</span></span><br><span class="line">            res.render(<span class="hljs-string">"admin/error"</span>, &#123;</span><br><span class="line">                url: <span class="hljs-literal">null</span>,</span><br><span class="line">                userInfo: req.userInfo,</span><br><span class="line">                message: <span class="hljs-string">"删除失败！"</span></span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p></p><p>最后重启服务器，在客户端中进行测试：<br><img src="http://pt2js28ws.bkt.clouddn.com/node_blog_23.gif" alt="分类完整测试"><br>好了，到此分类的添加，删除，修改基本上已经完成了。</p></div><ul class="post-copyright"><li><strong>本文标题：</strong><a href="https://tflin.com/post/1089098018.html">Node.js + Express + mongodb 的博客项目之前端ejs模块化及博客分类管理、分页功能实现（六）</a></li><li><strong>本文作者：</strong><a href="https://tflin.com">tflin</a></li><li><strong>本文链接：</strong><a href="https://tflin.com/post/1089098018.html">https://tflin.com/post/1089098018.html</a></li><li><strong>发布时间：</strong>2018-07-31</li><li><strong>版权声明：</strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明出处！</li></ul><div class="level is-size-7 is-uppercase"><div class="level-start"><div class="level-item"><i class="fas fa-tags has-text-grey"></i>&nbsp; <a class="has-link-grey -link" href="/tags/Express/">Express</a>,&nbsp;<a class="has-link-grey -link" href="/tags/Node-js/">Node.js</a>,&nbsp;<a class="has-link-grey -link" href="/tags/实战/">实战</a></div></div></div></div></div><div class="card card-transparent"><div class="level post-navigation is-flex-wrap is-mobile"><div class="level-start"><a class="level level-item has-link-grey article-nav-prev" href="/post/1938220084.html"><i class="level-item fas fa-chevron-left"></i> <span class="level-item">Node.js + Express + mongodb 的博客项目之博客内容的后台管理（七）</span></a></div><div class="level-end"><a class="level level-item has-link-grey article-nav-next" href="/post/192399754.html"><span class="level-item">Node.js + Express + mongodb 的博客项目之后台管理界面及用户管理（五）</span> <i class="level-item fas fa-chevron-right"></i></a></div></div></div><div class="card"><div class="card-content"><h3 class="title is-5 has-text-weight-normal">PS: 有问题，或者有不同意见，请移步至 <a href="https://github.com/tflins/tflins.github.io/issues" target="_blank">github</a> 提交 issues 进行讨论</h3></div></div></div><div class="column is-4-tablet is-4-desktop is-3-widescreen has-order-1 column-left is-sticky"><div class="card widget column-left is-sticky" id="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="is-flex" href="#前言"><span class="has-mr-6">1</span> <span>前言</span></a></li><li><a class="is-flex" href="#ejs-模板引擎的模块化"><span class="has-mr-6">2</span> <span>ejs 模板引擎的模块化</span></a></li><li><a class="is-flex" href="#内容显示分页的实现"><span class="has-mr-6">3</span> <span>内容显示分页的实现</span></a><ul class="menu-list"><li><a class="is-flex" href="#前端组件"><span class="has-mr-6">3.1</span> <span>前端组件</span></a></li><li><a class="is-flex" href="#后端模块"><span class="has-mr-6">3.2</span> <span>后端模块</span></a></li></ul></li><li><a class="is-flex" href="#博客的分类管理"><span class="has-mr-6">4</span> <span>博客的分类管理</span></a><ul class="menu-list"><li><a class="is-flex" href="#分类的数据结构"><span class="has-mr-6">4.1</span> <span>分类的数据结构</span></a></li><li><a class="is-flex" href="#分类管理首页"><span class="has-mr-6">4.2</span> <span>分类管理首页</span></a></li><li><a class="is-flex" href="#分类管理的添加"><span class="has-mr-6">4.3</span> <span>分类管理的添加</span></a></li><li><a class="is-flex" href="#分类管理的修改及删除"><span class="has-mr-6">4.4</span> <span>分类管理的修改及删除</span></a></li></ul></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start has-text-centered-mobile"><a class="footer-logo is-block has-mb-6" href="/"><img src="/images/logo.png" alt="Node.js + Express + mongodb 的博客项目之前端ejs模块化及博客分类管理、分页功能实现（六）" height="28"></a><p class="is-size-7">&copy; 2021 tflin&nbsp; Powered by <a href="http://tflin.com/" target="_blank">枫林晚记</a></p><p class="is-size-7">本站共计51.2k字</p></div><div class="level-end"><p class="is-size-7" style="text-align:center"><a href="https://beian.miit.gov.cn/" target="_blank">粤ICP备2021076261号-1</a></p></div><div class="level-end"><div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle"><p class="control"><a class="button is-white is-large" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-white is-large" target="_blank" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-white is-large" target="_blank" title="Download on GitHub" href="https://github.com/tflins"><i class="fab fa-github"></i></a></p></div></div></div></div><script type="text/javascript" src="https://s9.cnzz.com/z_stat.php?id=1279475949&web_id=1279475949"></script><style>a[title="站长统计"]{display:none}</style></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("zh-CN")</script><script>var IcarusThemeSettings={article:{highlight:{clipboard:!0,fold:""}}}</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script src="/js/gallery.js" defer></script><div id="outdated"><h6>Your browser is out-of-date!</h6><p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update my browser now</a></p><p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p></div><script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script><script>document.addEventListener("DOMContentLoaded",(function(){outdatedBrowser({bgColor:"#f25648",color:"#ffffff",lowerThan:"flex"})}))</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><script>document.addEventListener("DOMContentLoaded",(function(){MathJax.Hub.Config({"HTML-CSS":{matchFontHeight:!1},SVG:{matchFontHeight:!1},CommonHTML:{matchFontHeight:!1},tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]]}})}))</script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back-to-top.js" defer></script><script src="/js/main.js" defer></script><div class="searchbox ins-search"><div class="searchbox-container ins-search-container"><div class="searchbox-input-wrapper"><input type="text" class="searchbox-input ins-search-input" placeholder="想要查找什么..."> <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span></div><div class="searchbox-result-wrapper ins-section-wrapper"><div class="ins-section-container"></div></div></div></div><script>window.INSIGHT_CONFIG={TRANSLATION:{POSTS:"文章",PAGES:"页面",CATEGORIES:"分类",TAGS:"标签",UNTITLED:"(无标题)"},CONTENT_URL:"/content.json"}</script><script src="/js/insight.js" defer></script><link rel="stylesheet" href="/css/search.css"><link rel="stylesheet" href="/css/insight.css"><script src="//instant.page/5.1.0" type="module" integrity="sha384-by67kQnR+pyfy8yWP4kPO12fHKRLHZPfEsiSXR8u2IKcTdxD805MGUXBzVPnkLHw"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/z16.model.json"},"display":{"position":"right","width":150,"height":300,"hOffset":40},"mobile":{"show":false}});</script></body></html>