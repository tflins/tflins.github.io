<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><meta name="generator" content="Hexo 3.9.0"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><title>Node.js + Express + mongodb 的博客项目之评论系统（十） - 枫林晚记</title><meta name="description" content="前言本节内容主要是构建一个对博客文章的评论功能，由前端使用 ajax 通过 GET 方式向 /api/comment/post 路由提交评论，服务器再将其保存在数据库中。当用户没有登录时，会提示用户没有登录，不能评论。用户登陆以后，会显示一个评论文本框，用来给用户提交评论，提交后的评论会使用 ajax 进行局部刷新在博客文章的下方显示出来。提交的时候，会在前端进行简单的验证吗，验证通过后才能提交评"><meta name="keywords" content="Node.js,实战,Express"><meta property="og:type" content="article"><meta property="og:title" content="Node.js + Express + mongodb 的博客项目之评论系统（十）"><meta property="og:url" content="https://tflin.com/post/2575659366.html"><meta property="og:site_name" content="枫林晚记"><meta property="og:description" content="前言本节内容主要是构建一个对博客文章的评论功能，由前端使用 ajax 通过 GET 方式向 /api/comment/post 路由提交评论，服务器再将其保存在数据库中。当用户没有登录时，会提示用户没有登录，不能评论。用户登陆以后，会显示一个评论文本框，用来给用户提交评论，提交后的评论会使用 ajax 进行局部刷新在博客文章的下方显示出来。提交的时候，会在前端进行简单的验证吗，验证通过后才能提交评"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://tflin.com/images/og_image.png"><meta property="og:updated_time" content="2021-06-23T02:15:29.000Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Node.js + Express + mongodb 的博客项目之评论系统（十）"><meta name="twitter:description" content="前言本节内容主要是构建一个对博客文章的评论功能，由前端使用 ajax 通过 GET 方式向 /api/comment/post 路由提交评论，服务器再将其保存在数据库中。当用户没有登录时，会提示用户没有登录，不能评论。用户登陆以后，会显示一个评论文本框，用来给用户提交评论，提交后的评论会使用 ajax 进行局部刷新在博客文章的下方显示出来。提交的时候，会在前端进行简单的验证吗，验证通过后才能提交评"><meta name="twitter:image" content="https://tflin.com/images/og_image.png"><link rel="icon" href="/images/favicon.svg"><link rel="stylesheet" href="https://unpkg.com/bulma@0.7.2/css/bulma.css"><link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/5.4.1/css/all.min.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro"><link rel="stylesheet" href="https://unpkg.com/highlight.js@9.12.0/styles/atom-one-light.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><link rel="stylesheet" href="https://unpkg.com/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://unpkg.com/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><link rel="stylesheet" href="https://unpkg.com/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css"><link rel="stylesheet" href="/css/back-to-top.css"><link rel="stylesheet" href="/css/progressbar.css"><script src="https://unpkg.com/pace-js@1.0.2/pace.min.js"></script><link rel="stylesheet" href="/css/style.css"><meta name="referrer" content="no-referrer"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand is-flex-center"><a class="navbar-item navbar-logo" href="/"><img src="/images/logo.png" alt="Node.js + Express + mongodb 的博客项目之评论系统（十）" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" target="_self" href="/">首页</a> <a class="navbar-item" target="_self" href="/archives/">归档</a> <a class="navbar-item" target="_self" href="/categories/">分类</a> <a class="navbar-item" target="_self" href="/tags/">标签</a> <a class="navbar-item" target="_self" href="/chitchat/">闲言</a> <a class="navbar-item" target="_self" href="/about/">关于</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" title="Download on GitHub" href="https://github.com/tflins"><i class="fab fa-github"></i> </a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i> </a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column is-8-tablet is-8-desktop is-9-widescreen has-order-2 column-main"><div class="card"><div class="card-content article"><h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal"><i class="fas fa-angle-double-right"></i>Node.js + Express + mongodb 的博客项目之评论系统（十）</h1><div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto"><div class="level-left"><time class="level-item has-text-grey" datetime="2018-08-16T16:19:36.000Z"><i class="far fa-calendar-alt">&nbsp;</i>2018-08-17</time><div class="level-item"><a class="has-link-grey -link" href="/categories/后端/">后端</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/后端/Node-js/">Node.js</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/后端/Node-js/博客实战系列/">博客实战系列</a></div><span class="level-item has-text-grey">7 分钟 读完 (大约 1053 个字)</span></div></div><div class="content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本节内容主要是构建一个对博客文章的评论功能，由前端使用 ajax 通过 GET 方式向 /api/comment/post 路由提交评论，服务器再将其保存在数据库中。当用户没有登录时，会提示用户没有登录，不能评论。用户登陆以后，会显示一个评论文本框，用来给用户提交评论，提交后的评论会使用 ajax 进行局部刷新在博客文章的下方显示出来。提交的时候，会在前端进行简单的验证吗，验证通过后才能提交评论，否则 return false。</p><hr><a id="more"></a><h2 id="评论的前端界面"><a href="#评论的前端界面" class="headerlink" title="评论的前端界面"></a>评论的前端界面</h2><p>评论的界面，使用模板引擎的条件判断来根据当前用户是否登录来显示不同的界面，也就是使用前面 cookie 的信息来进行判断，若 userInfo.userid 存在则显示评论界面，反之提示未登录。为方便 ajax 获取需要向后端传送的文章 ID ，在这里将文章的 ID 设为一个隐藏的 input 的属性。<br>在 /views/main/views.ejs 中，在文章内容部分 (&lt;%- contentHtml %&gt;) 后，添加上如下代码：<br></p><figure class="highlight html hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-muted text-center"</span>&gt;</span>------------本文结束------------<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">          <span class="hljs-comment">&lt;!-- 评论 --&gt;</span></span><br><span class="line">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"well"</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"hidden"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"contentId"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"&lt;%= content.id %&gt;"</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">%</span> <span class="hljs-attr">if</span> (<span class="hljs-attr">userInfo.userid</span>) &#123;%&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span></span><br><span class="line">              <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"name"</span>&gt;</span>说点什么<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><br><span class="line">              <span class="hljs-tag">&lt;<span class="hljs-name">textarea</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span> <span class="hljs-attr">rows</span>=<span class="hljs-string">"3"</span> <span class="hljs-attr">cols</span>=<span class="hljs-string">"4"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"输入评论"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"comment"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">textarea</span>&gt;</span></span><br><span class="line">              <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></span><br><span class="line">              <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control btn btn-primary"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"comment-btn"</span>&gt;</span>提交<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">%</span> &#125; <span class="hljs-attr">else</span> &#123; %&gt;</span></span><br><span class="line">              <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"alert alert-danger"</span>&gt;</span>请先登录！<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">%</span> &#125; %&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"commentList"</span>&gt;</span></span><br><span class="line">              <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">                <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>作者 | 时间<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="line">                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>评论内容<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="line">              <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><hr><h2 id="数据库中的评论存储处理"><a href="#数据库中的评论存储处理" class="headerlink" title="数据库中的评论存储处理"></a>数据库中的评论存储处理</h2><p>为了方便，我暂时仅将博客的评论新增为文章集合的一个属性，并未新设一个集合。修改 /schemas/contents.js 文件，将博客文章的存储格式新增一个名为 comment 字段，类型为数组，默认为空数组。<br></p><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">comment: &#123;</span><br><span class="line">        type: <span class="hljs-built_in">Array</span>,</span><br><span class="line">        <span class="hljs-keyword">default</span>: []</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p></p><p>如此一来，博客文章的评论的数据库储存格式也暂时完成。</p><hr><h2 id="后端-api-处理"><a href="#后端-api-处理" class="headerlink" title="后端 api 处理"></a>后端 api 处理</h2><p>后端关于评论处理的接口主要有两个，一个是提交评论，另一个是读取评论。提交评论是由前端使用 ajax 通过 POST 的方式向服务器提交评论的用户和评论的内容，再由服务器进行相应的格式化处理后存入数据库中。而获取评论同样也是前端使用户 ajax 通过 GET 的方式向服务器提交需要获取评论的文章 ID ，再有服务器将该文章的所有评论从数据库中读取出来后传送给前端，由 ajax 局部刷新加载出来。<br>在 /routes/api.js 中，添加如下代码：<br></p><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// 获取评论的接口</span></span><br><span class="line">router.get(<span class="hljs-string">"/comment"</span>, (req, res) =&gt; &#123;</span><br><span class="line">    <span class="hljs-comment">//  获取提交的信息</span></span><br><span class="line">    <span class="hljs-keyword">let</span> contentId = req.query.contentId || <span class="hljs-string">""</span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// 根据id查询文章信息</span></span><br><span class="line">    contentModel.findById(contentId, (err, content) =&gt; &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (!err) &#123;</span><br><span class="line">            <span class="hljs-comment">// 向客户端发送当前评论</span></span><br><span class="line">            res.json(content.comment);</span><br><span class="line">            <span class="hljs-keyword">return</span>;</span><br><span class="line">        &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">            <span class="hljs-keyword">throw</span> err;</span><br><span class="line">            <span class="hljs-keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// 提交评论的接口</span></span><br><span class="line">router.post(<span class="hljs-string">"/comment/post"</span>, (req, res) =&gt; &#123;</span><br><span class="line">    <span class="hljs-comment">//  获取提交的信息</span></span><br><span class="line">    <span class="hljs-keyword">let</span> contentId = req.body.contentId;</span><br><span class="line">    <span class="hljs-keyword">let</span> comment = req.body.comment;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// 构建评论结构</span></span><br><span class="line">    <span class="hljs-keyword">let</span> commentData = &#123;</span><br><span class="line">        username: req.userInfo.username,</span><br><span class="line">		postTime: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(),</span><br><span class="line">		content: comment</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// 根据文章id将文章查询出来</span></span><br><span class="line">    contentModel.findById(contentId, (err, content) =&gt; &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (!err) &#123;</span><br><span class="line">            <span class="hljs-comment">// 如果文章存在则将评论推入</span></span><br><span class="line">            content.comment.push(commentData);</span><br><span class="line">            <span class="hljs-comment">// 保存</span></span><br><span class="line">            content.save();</span><br><span class="line">            <span class="hljs-comment">// 向客户端发送当前评论</span></span><br><span class="line">            res.json(content);</span><br><span class="line">            <span class="hljs-keyword">return</span>;</span><br><span class="line">        &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">            <span class="hljs-keyword">throw</span> err;</span><br><span class="line">            <span class="hljs-keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p></p><hr><h2 id="前端-ajax-处理"><a href="#前端-ajax-处理" class="headerlink" title="前端 ajax 处理"></a>前端 ajax 处理</h2><p>在 /public/js 文件夹中，新建一个 comment.js 文件用来处理评论相关的 ajax。内容如下：<br></p><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">$(() =&gt; &#123;</span><br><span class="line">    <span class="hljs-comment">// 提交评论</span></span><br><span class="line">    (<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="hljs-comment">// 获取提交按钮</span></span><br><span class="line">        $subBtn = $(<span class="hljs-string">"#comment-btn"</span>);</span><br><span class="line">        <span class="hljs-comment">// 获取评论内容</span></span><br><span class="line">        $comment = $(<span class="hljs-string">"#comment"</span>);</span><br><span class="line">        <span class="hljs-comment">// ajax请求</span></span><br><span class="line">        $subBtn.on(<span class="hljs-string">"click"</span>, () =&gt; &#123;</span><br><span class="line">            <span class="hljs-comment">// 简单验证</span></span><br><span class="line">            <span class="hljs-keyword">if</span> ($comment.val() === <span class="hljs-string">""</span>) &#123;</span><br><span class="line">                alert(<span class="hljs-string">"评论内容不能为空"</span>);</span><br><span class="line">                <span class="hljs-keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            $.ajax(&#123;</span><br><span class="line">                type: <span class="hljs-string">"post"</span>,</span><br><span class="line">                url: <span class="hljs-string">"/api/comment/post"</span>,</span><br><span class="line">                data: &#123;</span><br><span class="line">                    contentId: $(<span class="hljs-string">"#contentId"</span>).val(),</span><br><span class="line">                    comment: $comment.val()</span><br><span class="line">                &#125;,</span><br><span class="line">                dataType: <span class="hljs-string">"json"</span>,</span><br><span class="line">                success: <span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="hljs-comment">// 调用渲染评论函数</span></span><br><span class="line">                    renderComment();</span><br><span class="line">                    $comment.val(<span class="hljs-string">""</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;)();</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// 渲染评论的函数</span></span><br><span class="line">    renderComment = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="hljs-comment">// ajax请求</span></span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            type: <span class="hljs-string">"get"</span>,</span><br><span class="line">            url: <span class="hljs-string">"/api/comment/"</span>,</span><br><span class="line">            data: &#123;</span><br><span class="line">                contentId: $(<span class="hljs-string">"#contentId"</span>).val(),</span><br><span class="line">            &#125;,</span><br><span class="line">            dataType: <span class="hljs-string">"json"</span>,</span><br><span class="line">            success: <span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="hljs-comment">// 创建html结构</span></span><br><span class="line">                <span class="hljs-keyword">let</span> commentList = <span class="hljs-string">""</span>;</span><br><span class="line">                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = result.length - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) &#123;</span><br><span class="line">                    <span class="hljs-comment">// 格式化时间</span></span><br><span class="line">                    <span class="hljs-keyword">let</span> postTime =</span><br><span class="line">                    commentList += <span class="hljs-string">`</span></span><br><span class="line"><span class="hljs-string">                        &lt;div&gt;</span></span><br><span class="line"><span class="hljs-string">                            &lt;span&gt;用户：<span class="hljs-subst">$&#123; result[i].username &#125;</span> | 时间：<span class="hljs-subst">$&#123; result[i].postTime &#125;</span>&lt;/span&gt;</span></span><br><span class="line"><span class="hljs-string">                            &lt;p&gt;<span class="hljs-subst">$&#123; result[i].content &#125;</span>&lt;/p&gt;</span></span><br><span class="line"><span class="hljs-string">                        &lt;/div&gt;</span></span><br><span class="line"><span class="hljs-string">                    `</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="hljs-comment">// 添加进入html文档中</span></span><br><span class="line">                $(<span class="hljs-string">".commentList"</span>).html(commentList);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// 调用渲染评论函数</span></span><br><span class="line">    renderComment();</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p></p><hr><h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>最后再重启服务器，刷新客户端进行测试<br><img src="http://pt2js28ws.bkt.clouddn.com/node_blog_27.gif" alt="评论测试"></p></div><ul class="post-copyright"><li><strong>本文标题：</strong><a href="https://tflin.com/post/2575659366.html">Node.js + Express + mongodb 的博客项目之评论系统（十）</a></li><li><strong>本文作者：</strong><a href="https://tflin.com">tflin</a></li><li><strong>本文链接：</strong><a href="https://tflin.com/post/2575659366.html">https://tflin.com/post/2575659366.html</a></li><li><strong>发布时间：</strong>2018-08-17</li><li><strong>版权声明：</strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明出处！</li></ul><div class="level is-size-7 is-uppercase"><div class="level-start"><div class="level-item"><i class="fas fa-tags has-text-grey"></i>&nbsp; <a class="has-link-grey -link" href="/tags/Express/">Express</a>,&nbsp;<a class="has-link-grey -link" href="/tags/Node-js/">Node.js</a>,&nbsp;<a class="has-link-grey -link" href="/tags/实战/">实战</a></div></div></div></div></div><div class="card card-transparent"><div class="level post-navigation is-flex-wrap is-mobile"><div class="level-start"><a class="level level-item has-link-grey article-nav-prev" href="/post/2587019307.html"><i class="level-item fas fa-chevron-left"></i> <span class="level-item">Node.js + Express + mongodb 的博客项目之总结（十一）</span></a></div><div class="level-end"><a class="level level-item has-link-grey article-nav-next" href="/post/684096628.html"><span class="level-item">Node.js + Express + mongodb 的博客项目之博客文章内容详情界面及文章评论（九）</span> <i class="level-item fas fa-chevron-right"></i></a></div></div></div><div class="card"><div class="card-content">PS: 最近接入了 gitTalk , 也可以手动提交 <a href="https://github.com/tflins/tflins.github.io/issues" target="_blank">issues</a> 进行讨论，我会在第一时间进行回复。</div></div><div class="card"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script><div id="gitalk-container" class="card-content"></div><script>var gitalk=new Gitalk({clientID:"f0589ff42c2b05634ed4",clientSecret:"da3c036f6b666de8e508019b9fd1e23ce9ba3625",repo:"tflins.github.io",owner:"tflins",admin:["tflins"],id:location.pathname,distractionFreeMode:!1});gitalk.render("gitalk-container")</script></div></div><div class="column is-4-tablet is-4-desktop is-3-widescreen has-order-1 column-left is-sticky"><div class="card widget column-left is-sticky" id="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="is-flex" href="#前言"><span class="has-mr-6">1</span> <span>前言</span></a></li><li><a class="is-flex" href="#评论的前端界面"><span class="has-mr-6">2</span> <span>评论的前端界面</span></a></li><li><a class="is-flex" href="#数据库中的评论存储处理"><span class="has-mr-6">3</span> <span>数据库中的评论存储处理</span></a></li><li><a class="is-flex" href="#后端-api-处理"><span class="has-mr-6">4</span> <span>后端 api 处理</span></a></li><li><a class="is-flex" href="#前端-ajax-处理"><span class="has-mr-6">5</span> <span>前端 ajax 处理</span></a></li><li><a class="is-flex" href="#测试"><span class="has-mr-6">6</span> <span>测试</span></a></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start has-text-centered-mobile"><a class="footer-logo is-block has-mb-6" href="/"><img src="/images/logo.png" alt="Node.js + Express + mongodb 的博客项目之评论系统（十）" height="28"></a><p class="is-size-7">&copy; 2022 tflin&nbsp; Powered by <a href="http://tflin.com/" target="_blank">枫林晚记</a></p><p class="is-size-7">本站共计53.0k字</p><p class="is-size-7"><a href="https://beian.miit.gov.cn/" target="_blank">粤ICP备2021076261号-1</a></p></div><div class="level-end"><div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle"><p class="control"><a class="button is-white is-large" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-white is-large" target="_blank" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-white is-large" target="_blank" title="Download on GitHub" href="https://github.com/tflins"><i class="fab fa-github"></i></a></p></div></div></div></div><script type="text/javascript" src="https://s9.cnzz.com/z_stat.php?id=1279475949&web_id=1279475949"></script><style>a[title="站长统计"]{display:none}</style></footer><script src="https://unpkg.com/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://unpkg.com/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("zh-CN")</script><script>var IcarusThemeSettings={article:{highlight:{clipboard:!0,fold:""}}}</script><script src="https://unpkg.com/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><script src="https://unpkg.com/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://unpkg.com/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script src="/js/gallery.js" defer></script><div id="outdated"><h6>Your browser is out-of-date!</h6><p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update my browser now</a></p><p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p></div><script src="https://unpkg.com/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script><script>document.addEventListener("DOMContentLoaded",(function(){outdatedBrowser({bgColor:"#f25648",color:"#ffffff",lowerThan:"flex"})}))</script><script src="https://unpkg.com/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><script>document.addEventListener("DOMContentLoaded",(function(){MathJax.Hub.Config({"HTML-CSS":{matchFontHeight:!1},SVG:{matchFontHeight:!1},CommonHTML:{matchFontHeight:!1},tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]]}})}))</script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back-to-top.js" defer></script><script src="/js/main.js" defer></script><div class="searchbox ins-search"><div class="searchbox-container ins-search-container"><div class="searchbox-input-wrapper"><input type="text" class="searchbox-input ins-search-input" placeholder="想要查找什么..."> <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span></div><div class="searchbox-result-wrapper ins-section-wrapper"><div class="ins-section-container"></div></div></div></div><script>window.INSIGHT_CONFIG={TRANSLATION:{POSTS:"文章",PAGES:"页面",CATEGORIES:"分类",TAGS:"标签",UNTITLED:"(无标题)"},CONTENT_URL:"/content.json"}</script><script src="/js/insight.js" defer></script><link rel="stylesheet" href="/css/search.css"><link rel="stylesheet" href="/css/insight.css"><script src="//instant.page/5.1.0" type="module" integrity="sha384-by67kQnR+pyfy8yWP4kPO12fHKRLHZPfEsiSXR8u2IKcTdxD805MGUXBzVPnkLHw"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"scale":0.7,"jsonPath":"/live2dw/assets/z16.model.json"},"display":{"position":"right","width":150,"height":300,"hOffset":40,"vOffset":-65},"mobile":{"show":false}});</script></body></html>