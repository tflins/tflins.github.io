<!DOCTYPE html>
<html  lang="zh">
<head>
    <meta charset="utf-8" />

<meta name="generator" content="Hexo 3.9.0" />

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

<title>Node.js + Express + mongodb 的博客项目之模板引擎的配置及用户登录、注册（三） - 枫林晚记</title>


    <meta name="description" content="前言在这一节中，我们将会进行模板引擎的配置，以及博客前台的界面设计、并且设计博客的用户数据结构及连接数据库，实现用户的注册、登录。写得比较的详细，所以篇幅会较长，">
<meta name="keywords" content="Node.js,实战,Express">
<meta property="og:type" content="article">
<meta property="og:title" content="Node.js + Express + mongodb 的博客项目之模板引擎的配置及用户登录、注册（三）">
<meta property="og:url" content="https://tflin.com/2018/07/23/Node.js + Express + mongodb 的博客项目之模板引擎的配置及用户登录、注册（三）/index.html">
<meta property="og:site_name" content="枫林晚记">
<meta property="og:description" content="前言在这一节中，我们将会进行模板引擎的配置，以及博客前台的界面设计、并且设计博客的用户数据结构及连接数据库，实现用户的注册、登录。写得比较的详细，所以篇幅会较长，">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://tflin.com/images/og_image.png">
<meta property="og:updated_time" content="2021-03-16T02:12:52.324Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Node.js + Express + mongodb 的博客项目之模板引擎的配置及用户登录、注册（三）">
<meta name="twitter:description" content="前言在这一节中，我们将会进行模板引擎的配置，以及博客前台的界面设计、并且设计博客的用户数据结构及连接数据库，实现用户的注册、登录。写得比较的详细，所以篇幅会较长，">
<meta name="twitter:image" content="https://tflin.com/images/og_image.png">







<link rel="icon" href="/images/favicon.svg">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/5.4.1/css/all.min.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css">


    
    
    
    <style>body>.footer,body>.navbar,body>.section{opacity:0}</style>
    

    
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">
    

    
    

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">


    
    
    
    

<link rel="stylesheet" href="/css/back-to-top.css">


    
    

    
    
    
    

    
    
<link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>

    
    
    


<link rel="stylesheet" href="/css/style.css">
    <meta name="referrer" content="no-referrer" />
</head>
<body class="is-3-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/logo.png" alt="Node.js + Express + mongodb 的博客项目之模板引擎的配置及用户登录、注册（三）" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item"
                target="_self"
                href="/">首页</a>
                
                <a class="navbar-item"
                target="_self"
                href="/archives">归档</a>
                
                <a class="navbar-item"
                target="_self"
                href="/categories">分类</a>
                
                <a class="navbar-item"
                target="_self"
                href="/tags">标签</a>
                
                <a class="navbar-item"
                target="_self"
                href="/chitchat">闲言</a>
                
                <a class="navbar-item"
                target="_blank"
                href="/resume">简历</a>
                
                <a class="navbar-item"
                target="_self"
                href="/about">关于</a>
                
                <a class="navbar-item"
                target="_blank"
                href="/notes">个人前端知识体系</a>
                
            </div>
            
            <div class="navbar-end">
                
                    
                    
                    <a class="navbar-item" target="_blank" title="Download on GitHub" href="https://github.com/tflins">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                    
                
                
                <a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;">
                    <i class="fas fa-list-ul"></i>
                </a>
                
                
                <a class="navbar-item search" title="搜索" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-9-widescreen has-order-2 column-main"><div class="card">
    
    <div class="card-content article ">
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <i class="fas fa-angle-double-right"></i>Node.js + Express + mongodb 的博客项目之模板引擎的配置及用户登录、注册（三）
            
        </h1>
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2018-07-23T09:38:41.000Z"><i class="far fa-calendar-alt">&nbsp;</i>2018-07-23</time>
                
                <time class="level-item has-text-grey is-hidden-mobile" datetime="2021-03-16T02:12:52.324Z"><i class="far fa-calendar-check">&nbsp;</i>2021-03-16</time>
                
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/后端/">后端</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/后端/Node-js/">Node.js</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/后端/Node-js/博客实战系列/">博客实战系列</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    26 分钟 读完 (大约 3886 个字)
                </span>
                
                
            </div>
        </div>
        
        <div class="content">
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在这一节中，我们将会进行模板引擎的配置，以及博客前台的界面设计、并且设计博客的用户数据结构及连接数据库，实现用户的注册、登录。写得比较的详细，所以篇幅会较长，</p>
<hr>
<a id="more"></a>
<h2 id="模板引擎的配置"><a href="#模板引擎的配置" class="headerlink" title="模板引擎的配置"></a>模板引擎的配置</h2><p>模板引擎是为了实现模板文件与业务数据的结合，实现界面与数据的分离。同时，还可以进行组件化开发，减少我们的代码量，可复用。</p>
<p>在 Express 中配置模板引擎的过程一般如下</p>
<ol>
<li>views, 放模板文件的目录，比如： app.set(“views”, “./views”)</li>
<li>view engine, 模板引擎，比如： app.set(“view engine”, “ejs”)<br>一旦 view engine 设置成功，就不需要显式指定引擎，或者在应用中加载模板引擎模块，Express 已经在内部加载。<br>在 app.js 添加代码如下：<figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// 引入路径模块</span></span><br><span class="line"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">"path"</span>);</span><br><span class="line"><span class="hljs-comment">/*</span></span><br><span class="line"><span class="hljs-comment">配置模板引擎</span></span><br><span class="line"><span class="hljs-comment">*/</span></span><br><span class="line"><span class="hljs-comment">// 设置模板引擎的存放目录为当前被执行的js文件的相对目录views</span></span><br><span class="line">app.set(<span class="hljs-string">"views"</span>, path.join(__dirname, <span class="hljs-string">"views"</span>));</span><br><span class="line"><span class="hljs-comment">// 设置模板引擎为ejs</span></span><br><span class="line">app.set(<span class="hljs-string">"view engine"</span>, <span class="hljs-string">"ejs"</span>);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>配置完模板引擎，就可以使用模板引擎进行数据渲染了，通过 res.render() 调用其导出方法 __express(filePath, options, callback) 渲染模板。</p>
<hr>
<p>这个时候我们在 views 目录下新建一个文件 main/index.ejs 作为博客的主页<br><figure class="highlight html hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>TFLIN'BLOG<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>欢迎来到我的博客<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<hr>
<p>接着在 app.js 文件修改为如下代码，使用 res.render() 后端渲染模板。<br>将<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 给app绑定路由，所有通过&quot;/&quot;的url都将通过以下方法</span><br><span class="line">app.get(&quot;/&quot;, (req, res, next) =&gt; &#123;</span><br><span class="line">    // 发送内容至客户端</span><br><span class="line">    res.send(&quot;&lt;h1&gt;TFL BLOG&lt;/h1&gt;&quot;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>修改为<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 给app绑定路由，所有通过&quot;/&quot;的url都将通过以下方法</span><br><span class="line">app.get(&quot;/&quot;, (req, res, next) =&gt; &#123;</span><br><span class="line">    // 渲染admin/index模板</span><br><span class="line">    res.render(&quot;main/index&quot;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>这个时候，node app 启动项目，然后在浏览器中输入地址，就可以看到模板已经被渲染出来了<br><img src="http://pt2js28ws.bkt.clouddn.com/node_blog_4.jpg" alt="渲染模板"></p>
<hr>
<h2 id="配置服务器静态资源库"><a href="#配置服务器静态资源库" class="headerlink" title="配置服务器静态资源库"></a>配置服务器静态资源库</h2><p>在 Node.js 服务器中，没有其他类似其他服务器一样有个专门存放静态资源的地方，我们需要对此进行相应的配置，实现对应的功能。在原生 Node.js 中，我们实现这个过程需要考虑很多种情况，而 express 框架，用 express.static 一行代码就可以达到目的了。<br>在 app.js 添加如下代码，配置服务器静态资源库<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 使用中间件设置静态资源库的目录</span><br><span class="line">app.use(&quot;/public&quot;, express.static(path.join(__dirname, &quot;/public&quot;)));</span><br></pre></td></tr></table></figure></p>
<p>这样我们就可以在 /public 目录下存放相关的静态资源了，我们这个项目是便捷开发，所以我们先在静态资源库中存放 jQuery、Bootstrap 相关文件。<br><img src="http://pt2js28ws.bkt.clouddn.com/node_blog_5.jpg" alt="静态资源"></p>
<hr>
<p>我们再对 main/index.ejs 文件进行相应的内容及样式设计<br><figure class="highlight html hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span>&gt;</span></span><br><span class="line">  <span class="hljs-comment">&lt;!--引用bootstrap样式--&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/public/css/bootstrap.min.css"</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>TFLIN'BLOG<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">header</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">header</span>&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;<span class="hljs-name">nav</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar navbar-default"</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar-header"</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar-brand"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/"</span>&gt;</span>TFL'BLOG<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span></span><br><span class="line">          <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav navbar-nav"</span>&gt;</span></span><br><span class="line">              <span class="hljs-tag">&lt;<span class="hljs-name">li</span>  <span class="hljs-attr">class</span>=<span class="hljs-string">"active"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/"</span>&gt;</span>首页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="line">              <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"javascript:;"</span>&gt;</span>Java<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="line">              <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"javascript:;"</span>&gt;</span>Python<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="line">              <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"javascript:;"</span>&gt;</span>Node.js<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="line">          <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>重启服务器，再次查看浏览器<br><img src="http://pt2js28ws.bkt.clouddn.com/node_blog_6.jpg" alt="静态资源库样式"><br>看到之前我们设置的样式已经生效了，说明静态资源库设置成功。</p>
<hr>
<h2 id="路由配置"><a href="#路由配置" class="headerlink" title="路由配置"></a>路由配置</h2><p>我们在实现相应的功能之前，要进行相应的路由配置，也就是实现分模块开发。在 /routes 目录下新建以下文件，用于路由配置。</p>
<ol>
<li>api.js –&gt; 提供登录，注册，登出接口</li>
<li>main.js –&gt; 前台路由文件</li>
<li>admin.js –&gt; 后台管理路由文件<br><img src="http://pt2js28ws.bkt.clouddn.com/node_blog_7.jpg" alt="路由文件"></li>
</ol>
<hr>
<p>然后在 app.js 将<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 给app绑定路由，所有通过&quot;/&quot;的url都将通过以下方法</span><br><span class="line">app.get(&quot;/&quot;, (req, res, next) =&gt; &#123;</span><br><span class="line">    // 渲染admin/index模板</span><br><span class="line">    res.render(&quot;main/index&quot;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>修改为以下代码，实现路由分模块处理<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line">路由处理</span><br><span class="line">*/</span><br><span class="line">// 所有通过&quot;/&quot;的url，都由./routes/main.js文件进行处理</span><br><span class="line">app.use(&quot;/&quot;, require(&quot;./routes/main.js&quot;));</span><br></pre></td></tr></table></figure></p>
<p>再修改 main.js 首页路由<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// 引入相关模块</span><br><span class="line">const express = require(&quot;express&quot;);</span><br><span class="line"></span><br><span class="line">// 实例化Router对象</span><br><span class="line">const router = express.Router();</span><br><span class="line"></span><br><span class="line">// 首页路由配置</span><br><span class="line">router.get(&quot;/&quot;, (req, res) =&gt; &#123;</span><br><span class="line">    // 渲染首页模板</span><br><span class="line">    res.render(&quot;main/index&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 将其暴露给外部使用</span><br><span class="line">module.exports = router;</span><br></pre></td></tr></table></figure></p>
<p>最后在重启服务器，测试，依旧成功！<br><img src="http://pt2js28ws.bkt.clouddn.com/node_blog_6.jpg" alt="路由文件"></p>
<hr>
<h2 id="注册、登录、登出的实现"><a href="#注册、登录、登出的实现" class="headerlink" title="注册、登录、登出的实现"></a>注册、登录、登出的实现</h2><h3 id="前台界面设计"><a href="#前台界面设计" class="headerlink" title="前台界面设计"></a>前台界面设计</h3><p>要实现登录注册等，我们先在前端写出相应内容，然后在通过 ajax 的方式提交请求到后端。<br>修改 main/inde.ejs 为如下，进行简单的界面设计：<br><figure class="highlight html hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span>&gt;</span></span><br><span class="line">  <span class="hljs-comment">&lt;!--引用bootstrap样式--&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/public/css/bootstrap.min.css"</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>TFLIN'BLOG<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span><br><span class="line">  <span class="hljs-comment">&lt;!-- 页头 --&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">header</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">header</span>&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;<span class="hljs-name">nav</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar navbar-default"</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar-header"</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar-brand"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/"</span>&gt;</span>TFL'BLOG<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span></span><br><span class="line">          <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav navbar-nav"</span>&gt;</span></span><br><span class="line">              <span class="hljs-tag">&lt;<span class="hljs-name">li</span>  <span class="hljs-attr">class</span>=<span class="hljs-string">"active"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/"</span>&gt;</span>首页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="line">              <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"javascript:;"</span>&gt;</span>Java<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="line">              <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"javascript:;"</span>&gt;</span>Python<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="line">              <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"javascript:;"</span>&gt;</span>Node.js<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="line">          <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span></span><br><span class="line">  <span class="hljs-comment">&lt;!-- 主体 --&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span></span><br><span class="line">    <span class="hljs-comment">&lt;!-- 内容部分 --&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-md-8"</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"well"</span>&gt;</span></span><br><span class="line">          <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>博客标题<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span></span><br><span class="line">          <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>内容简介<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="line">          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"javascript:;"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-info"</span>&gt;</span>阅读全文<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="line">          <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-info pull-right"</span>&gt;</span>点击量 时间 作者 分类<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"well"</span>&gt;</span></span><br><span class="line">          <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>博客标题<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span></span><br><span class="line">          <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>内容简介<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="line">          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"javascript:;"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-info"</span>&gt;</span>阅读全文<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="line">          <span class="hljs-tag">&lt;<span class="hljs-name">span</span>  <span class="hljs-attr">class</span>=<span class="hljs-string">"text-info pull-right"</span>&gt;</span>点击量 时间 作者 分类<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"well"</span>&gt;</span></span><br><span class="line">          <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>博客标题<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span></span><br><span class="line">          <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>内容简介<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="line">          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"javascript:;"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-info"</span>&gt;</span>阅读全文<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="line">          <span class="hljs-tag">&lt;<span class="hljs-name">span</span>  <span class="hljs-attr">class</span>=<span class="hljs-string">"text-info pull-right"</span>&gt;</span>点击量 时间 作者 分类<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">    <span class="hljs-comment">&lt;!-- 登录、注册、用户面板部分 --&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-md-4"</span>&gt;</span></span><br><span class="line">      <span class="hljs-comment">&lt;!-- 登录面板 --&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"login"</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>登录<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"input-group"</span>&gt;</span></span><br><span class="line">  			  <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"input-group-addon"</span>&gt;</span>用户<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="line">  			  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"请输入用户名"</span>&gt;</span></span><br><span class="line">  		  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"input-group"</span>&gt;</span></span><br><span class="line">          <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"input-group-addon"</span>&gt;</span>密码<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="line">          <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"请输入密码"</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-primary form-control"</span>&gt;</span>登录<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"javascripts:;"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-md-offset-4"</span>&gt;</span>没有账号？点击注册<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="line">        <span class="hljs-comment">&lt;!-- 警告框 --&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"alert alert-success alert-dismissable hide"</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"alert"</span>&gt;</span></span><br><span class="line">          <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"close"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span>&gt;</span>×<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="line">          <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>恭喜您操作成功！<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">      <span class="hljs-comment">&lt;!-- 注册面板 --&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"reg"</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>注册<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"input-group"</span>&gt;</span></span><br><span class="line">  			  <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"input-group-addon"</span>&gt;</span>用户名称<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="line">  			  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"请输入用户名"</span>&gt;</span></span><br><span class="line">  		  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"input-group"</span>&gt;</span></span><br><span class="line">          <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"input-group-addon"</span>&gt;</span>输入密码<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="line">          <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"请输入密码"</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"input-group"</span>&gt;</span></span><br><span class="line">          <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"input-group-addon"</span>&gt;</span>确认密码<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="line">          <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"请再次输入密码"</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-primary form-control"</span>&gt;</span>注册<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"javascripts:;"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-md-offset-4"</span>&gt;</span>已有账号？点击登录<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="line">        <span class="hljs-comment">&lt;!-- 警告框 --&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"alert alert-success alert-dismissable hide"</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"alert"</span>&gt;</span></span><br><span class="line">          <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"close"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span>&gt;</span>×<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="line">          <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>恭喜您操作成功！<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">      <span class="hljs-comment">&lt;!-- 用户面板 --&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"user-info"</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"panel panel-primary"</span>&gt;</span></span><br><span class="line">        	<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"panel-heading"</span>&gt;</span>用户面板<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"panel-body"</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>欢迎，xxx<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span></span><br><span class="line">              <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-danger form-control"</span>&gt;</span>注销<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="line">          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/public/js/3.3.1-jquery-min.js"</span>&gt;</span><span class="hljs-undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="line"> <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/public/js/bootstrap.min.js"</span>&gt;</span><span class="hljs-undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>在浏览器中刷新，效果如下：<br><img src="http://pt2js28ws.bkt.clouddn.com/node_blog_8.jpg" alt="前台界面"></p>
<hr>
<h3 id="用户表结构的设计及连接数据库"><a href="#用户表结构的设计及连接数据库" class="headerlink" title="用户表结构的设计及连接数据库"></a>用户表结构的设计及连接数据库</h3><p>在写用户模块之前，我们先对用户的表结构进行设计。在 schemas 目录下，新建一个 users.js 的文件，用来设计用户的数据结构。<br>schemas/users.js 代码如下：<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">// 引入mongoose模块，驱动mongodb数据库</span><br><span class="line">const mongoose = require(&quot;mongoose&quot;);</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">用户的数据结构</span><br><span class="line">&#123;</span><br><span class="line">    用户名，字符串类型</span><br><span class="line">    用户密码，字符串类型</span><br><span class="line">    是否为管理员，布尔类型，默认为false</span><br><span class="line">&#125;</span><br><span class="line">*/</span><br><span class="line">module.exports = new mongoose.Schema(&#123;</span><br><span class="line">    username: String,</span><br><span class="line">    password: String,</span><br><span class="line">    isadmin: &#123;</span><br><span class="line">        type: Boolean,</span><br><span class="line">        default: false</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>创建完用户的 Schema 对象以后，我们在 models 中创建用户模型，通过用户模型类操作数据库.<br>models/user.js 代码如下：<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 引入mongoose模块</span><br><span class="line">const mongoose = require(&quot;mongoose&quot;);</span><br><span class="line">// 引入user的schema</span><br><span class="line">const userSchema = require(&quot;../schemas/users.js&quot;);</span><br><span class="line"></span><br><span class="line">// 创建user对象模型，并暴露出去</span><br><span class="line">module.exports = mongoose.model(&quot;user&quot;, userSchema);</span><br></pre></td></tr></table></figure></p>
<p>然后我们在项目入口文件 app.js 进行数据库连接，再引入 mongoose 模块后，将 app.js 中监听端口号的部分改为：<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// 连接数据库</span><br><span class="line">mongoose.connect(&quot;mongodb://localhost:27017/blog_db&quot;, (err) =&gt; &#123;</span><br><span class="line">    if (!err) &#123;</span><br><span class="line">        // 如果没出错，监听端口号</span><br><span class="line">        app.listen(8080);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        // 出错则抛出异常</span><br><span class="line">        console.log(&quot;数据库连接成功！&quot;);</span><br><span class="line">        throw err;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>这个时候，我们先在命令行使用 mongod 命令启动 mongodb 服务，当然也可以将该服务设置成系统服务，就不用每次都手动启动服务了。<br><img src="http://pt2js28ws.bkt.clouddn.com/node_blog_9.jpg" alt="启动数据库服务"><br>mongodb 服务启动完成后，就可以 重启服务器了，node app:<br><img src="http://pt2js28ws.bkt.clouddn.com/node_blog_10.jpg" alt="重启服务器"><br>可以看到，此时我们的数据库已经连接成功了。</p>
<hr>
<h3 id="前端交互设计"><a href="#前端交互设计" class="headerlink" title="前端交互设计"></a>前端交互设计</h3><p>在写相关接口前，先把博客前台的交互简单处理一下，就是先显示登录的界面，将注册的界面给隐藏起来，由用户点击切换相关面板，同时通过 ajax 提交数据到相关接口进行处理。<br>我们先把用户注册面板和用户信息面板隐藏起来，在 views/main/index.ejs 中给它们加上一个 .hide 的 class。<br>在 /public/js 目录下新建一个 main.js 用于处理博客首页的相关交互，main.js 的代码如下：<br><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">$(() =&gt; &#123;</span><br><span class="line">    <span class="hljs-comment">// 获取点击注册的连接</span></span><br><span class="line">    <span class="hljs-keyword">const</span> $regLink = $(<span class="hljs-string">"#login a"</span>);</span><br><span class="line">    <span class="hljs-comment">// 获取点击登录的连接</span></span><br><span class="line">    <span class="hljs-keyword">const</span> $loginLink = $(<span class="hljs-string">"#reg a"</span>);</span><br><span class="line">    <span class="hljs-comment">// 获取登录的div</span></span><br><span class="line">    <span class="hljs-keyword">const</span> $loginDiv = $(<span class="hljs-string">"#login"</span>);</span><br><span class="line">    <span class="hljs-comment">// 获取注册的div</span></span><br><span class="line">    <span class="hljs-keyword">const</span> $regDiv = $(<span class="hljs-string">"#reg"</span>);</span><br><span class="line">    <span class="hljs-comment">// 获取登录按钮</span></span><br><span class="line">    <span class="hljs-keyword">const</span> $loginBtn = $(<span class="hljs-string">"#login-btn"</span>);</span><br><span class="line">    <span class="hljs-comment">// 获取注册按钮</span></span><br><span class="line">    <span class="hljs-keyword">const</span> $regBtn = $(<span class="hljs-string">"#reg-btn"</span>);</span><br><span class="line">    <span class="hljs-comment">// 获取警告框</span></span><br><span class="line">    <span class="hljs-keyword">const</span> $warningBox = $(<span class="hljs-string">".alert"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// 切换到登录/注册界面的方法</span></span><br><span class="line">    (<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="hljs-comment">// 注册点击事件</span></span><br><span class="line">        $regLink.on(<span class="hljs-string">"click"</span>, () =&gt; &#123;</span><br><span class="line">            <span class="hljs-comment">// 隐藏登录界面</span></span><br><span class="line">            $loginDiv.hide();</span><br><span class="line">            <span class="hljs-comment">// 显示注册界面</span></span><br><span class="line">            $regDiv.removeClass(<span class="hljs-string">"hide"</span>);</span><br><span class="line">            $regDiv.addClass(<span class="hljs-string">"show"</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="hljs-comment">// 注册点击事件</span></span><br><span class="line">        $loginLink.on(<span class="hljs-string">"click"</span>, () =&gt; &#123;</span><br><span class="line">            <span class="hljs-comment">// 隐藏注册界面</span></span><br><span class="line">            $regDiv.hide();</span><br><span class="line">            $regDiv.removeClass(<span class="hljs-string">"show"</span>);</span><br><span class="line">            <span class="hljs-comment">// 显示登录界面</span></span><br><span class="line">            $loginDiv.show();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;)();</span><br><span class="line">    </span><br><span class="line">    <span class="hljs-comment">// 警告框的关闭</span></span><br><span class="line">    (<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">        $(<span class="hljs-string">"button[class='close']"</span>).bind(<span class="hljs-string">"click"</span>, (e) =&gt; &#123;</span><br><span class="line">            $warningBox.addClass(<span class="hljs-string">"hide"</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;)();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>这样我们就可以得到一个简答的交互效果，如下图<br><img src="http://pt2js28ws.bkt.clouddn.com/node_blog_11.gif" alt="登录注册切换"></p>
<hr>
<h3 id="用户注册的接口"><a href="#用户注册的接口" class="headerlink" title="用户注册的接口"></a>用户注册的接口</h3><p>博客的相关接口我们在 api.js 文件中写，在 api.js 中，我们先定义一个返回给前端的 json 数据，里面包含有请求的状态码，以及返回的提示消息。而前端的登录与注册是通过 ajax 与后端进行相应的交互，所以我们通过 POST 的方式请求。我们想要获取解析前端通过 POST 提交的数据，就需要 Express 的一个中间模块 body-parser 。body-parser 提供了 bodyParser.json(), bodyParser.raw(), bodyParser.text(), bodyParser.urlencoded() 四种解析数据的方法，其中 <strong>bodyParser.urlencoded()</strong> 支持utf-8 的解析方式。该方法提供了多个参数，而我们用到的是 extended ，当 extended 的值为 false 的时候会使用 querystring 来解析 url 格式的数据，值为 true 则会以 qs 库来解析，默认为 true。这里有一篇文章对该中间件进行了讲解，可以去看看 –&gt; <a href="https://www.jianshu.com/p/ea0122ad1ac0" target="_blank" rel="noopener">Express 中间件—-body-parser</a><br>我们在 app.js 中添加如下代码对 body-parser 进行相应的配置：<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// 引入body-parser模块</span><br><span class="line">const bodyParser = require(&quot;body-parser&quot;);</span><br><span class="line"></span><br><span class="line">// body-parser配置</span><br><span class="line">app.use(bodyParser.urlencoded(&#123;extended: true&#125;))</span><br><span class="line"></span><br><span class="line">// 注意：中间件要写在路由配置前，否则容易出错</span><br><span class="line"></span><br><span class="line">// 所有通过&quot;/api&quot;的url，都由./routes/api.js文件进行处理</span><br><span class="line">app.use(&quot;/api&quot;, require(&quot;./routes/api.js&quot;));</span><br></pre></td></tr></table></figure></p>
<p>配置完 body-parser 后我们就可以使用 req.body 来获取前端传过来的post信息。接下来在 api.js 中添加如下代码：<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">// 引入相关模块</span><br><span class="line">const express = require(&quot;express&quot;);</span><br><span class="line">// 引入用户数据模型，进行相应的操作</span><br><span class="line">const userModel = require(&quot;../models/user&quot;);</span><br><span class="line"></span><br><span class="line">// 实例化Router对象</span><br><span class="line">const router = express.Router();</span><br><span class="line"></span><br><span class="line">// 定义一个返回给前端的消息对象</span><br><span class="line">let responseData;</span><br><span class="line">// 通过中间件对其进行初始化，这样每一次请求都会进行初始化</span><br><span class="line">router.use((req, res, next) =&gt; &#123;</span><br><span class="line">    responseData = &#123;</span><br><span class="line">        // 状态码</span><br><span class="line">        code: 0,</span><br><span class="line">        // 返回的消息</span><br><span class="line">        message: &quot;&quot;</span><br><span class="line">    &#125;;</span><br><span class="line">    next();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">    用户注册的接口：</span><br><span class="line">        提交的验证：</span><br><span class="line">            1.用户名不能为空</span><br><span class="line">            2.密码不能为空</span><br><span class="line">            3.两次密码必须一致</span><br><span class="line">        数据库验证：</span><br><span class="line">            1.用户名是否已存在</span><br><span class="line">*/</span><br><span class="line">router.post(&quot;/user/register&quot;, (req, res, next) =&gt; &#123;</span><br><span class="line">    // 用户名</span><br><span class="line">    let username = req.body.username;</span><br><span class="line">    // 密码</span><br><span class="line">    let password = req.body.password;</span><br><span class="line">    // 确认密码</span><br><span class="line">    let repassword = req.body.repassword;</span><br><span class="line"></span><br><span class="line">    // 用户名不能为空</span><br><span class="line">    if (username === &quot;&quot;) &#123;</span><br><span class="line">        // 设置数据</span><br><span class="line">        responseData.code = 1;</span><br><span class="line">        responseData.message = &quot;用户名不能为空！&quot;;</span><br><span class="line">        // 给客户端发送一个json的相应</span><br><span class="line">        res.json(responseData);</span><br><span class="line"></span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    // 密码不能为空</span><br><span class="line">    if (password === &quot;&quot; || repassword === &quot;&quot;) &#123;</span><br><span class="line">        responseData.code = 2;</span><br><span class="line">        responseData.message = &quot;密码或确认密码不能为空！&quot;;</span><br><span class="line">        res.json(responseData);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    // 两次密码必须一致</span><br><span class="line">    if (password !== repassword) &#123;</span><br><span class="line">        responseData.code = 3;</span><br><span class="line">        responseData.message = &quot;两次密码不一致！&quot;;</span><br><span class="line">        res.json(responseData);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 向数据库中查询用户名是否已存在</span><br><span class="line">    userModel.findOne(&#123;username: username&#125;, (err, user) =&gt; &#123;</span><br><span class="line">        // 如果用户名已存在</span><br><span class="line">        if (user) &#123;</span><br><span class="line">            responseData.code = 4;</span><br><span class="line">            responseData.message = &quot;该用户名已存在！&quot;;</span><br><span class="line">            res.json(responseData);</span><br><span class="line">            return;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            // 用户名不存在，则新建用户</span><br><span class="line">            userModel.create(&#123;</span><br><span class="line">                username: username,</span><br><span class="line">                password: password</span><br><span class="line">            &#125;, (err) =&gt; &#123;</span><br><span class="line">                if (!err) &#123;</span><br><span class="line">                    responseData.message = &quot;注册成功！&quot;;</span><br><span class="line">                    res.json(responseData);</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    console.log(err);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 将其暴露给外部</span><br><span class="line">module.exports = router;</span><br></pre></td></tr></table></figure></p>
<p>此时后台的用户注册接口已经写好了，我们在前端通过 ajax 去请求该接口，在博客首页的 js 文件 public/js/main.js 中添加如下代码：<br><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// ajax请求</span></span><br><span class="line">    (<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="hljs-comment">// 用户注册</span></span><br><span class="line">        $regBtn.on(<span class="hljs-string">"click"</span>, () =&gt; &#123;</span><br><span class="line">            <span class="hljs-comment">// 通过ajax提交数据</span></span><br><span class="line">            $.ajax(&#123;</span><br><span class="line">                type: <span class="hljs-string">"post"</span>,</span><br><span class="line">                url: <span class="hljs-string">"/api/user/register"</span>,</span><br><span class="line">                data: &#123;</span><br><span class="line">                    username: $(<span class="hljs-string">"#reg [name='username']"</span>).val(),</span><br><span class="line">                    password: $(<span class="hljs-string">"#reg [name='password']"</span>).val(),</span><br><span class="line">                    repassword: $(<span class="hljs-string">"#reg [name='repassword']"</span>).val()</span><br><span class="line">                &#125;,</span><br><span class="line">                dataType: <span class="hljs-string">"json"</span>,</span><br><span class="line">                success: <span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="hljs-keyword">if</span> (result.code) &#123;</span><br><span class="line">                        $warningBox.find(<span class="hljs-string">"span"</span>).html(<span class="hljs-string">"警告："</span> + result.message);</span><br><span class="line">                        $warningBox.addClass(<span class="hljs-string">"alert-danger"</span>)</span><br><span class="line">                        $warningBox.removeClass(<span class="hljs-string">"hide alert-success"</span>);</span><br><span class="line">                    &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">                        $warningBox.find(<span class="hljs-string">"span"</span>).html(<span class="hljs-string">"恭喜您"</span> + result.message);</span><br><span class="line">                        $warningBox.addClass(<span class="hljs-string">"alert-success"</span>)</span><br><span class="line">                        $warningBox.removeClass(<span class="hljs-string">"hide alert-danger"</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;)();</span><br></pre></td></tr></table></figure></p>
<p>后端的用户注册接口已经写完了，前端的 ajax 请求也写完了，我们就可以重启服务器进行测试了，我们先在数据库中新建一个用户叫 admin 以便进行用户名冲突测试，使用 node app 重启服务器，在客户端中刷新网页，进行测试：<br><img src="http://pt2js28ws.bkt.clouddn.com/node_blog_12.gif" alt="注册测试"><br>前端和服务器方面没有问题，我们再到数据库中看看，发现新注册的用户已经存入数据库中了<br><img src="http://pt2js28ws.bkt.clouddn.com/node_blog_13.jpg" alt="注册数据库"><br>到这里用户注册算是基本完成了。</p>
<hr>
<h3 id="用户登录的接口"><a href="#用户登录的接口" class="headerlink" title="用户登录的接口"></a>用户登录的接口</h3><p>用户登录的实现基本上和用户注册的逻辑差不多，前端 ajax 提交数据到后端，后端进行相应的验证，并将验证结果返回给前端。后端的登录接口设计为 POST api/user/login。<br>在 routes/api.js 文件中添加如下代码，实现登录接口：<br><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/*</span></span><br><span class="line"><span class="hljs-comment">    用户登录的接口</span></span><br><span class="line"><span class="hljs-comment">        提交的验证：</span></span><br><span class="line"><span class="hljs-comment">            1.用户名不能为空</span></span><br><span class="line"><span class="hljs-comment">            2.密码不能为空</span></span><br><span class="line"><span class="hljs-comment">        数据库的验证：</span></span><br><span class="line"><span class="hljs-comment">            1.用户名是否存在</span></span><br><span class="line"><span class="hljs-comment">            2.若存在密码是否正确</span></span><br><span class="line"><span class="hljs-comment">*/</span></span><br><span class="line">router.post(<span class="hljs-string">"/user/login"</span>, (req, res, next) =&gt; &#123;</span><br><span class="line">    <span class="hljs-comment">// 用户名</span></span><br><span class="line">    <span class="hljs-keyword">let</span> username = req.body.username;</span><br><span class="line">    <span class="hljs-comment">// 密码</span></span><br><span class="line">    <span class="hljs-keyword">let</span> password = req.body.password;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// 用户名不能为空</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (username === <span class="hljs-string">""</span>) &#123;</span><br><span class="line">        responseData.code = <span class="hljs-number">1</span>;</span><br><span class="line">        responseData.message = <span class="hljs-string">"用户名不能为空！"</span>;</span><br><span class="line">        res.json(responseData);</span><br><span class="line">        <span class="hljs-keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-comment">// 密码不能为空</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (password === <span class="hljs-string">""</span>) &#123;</span><br><span class="line">        responseData.code = <span class="hljs-number">2</span>;</span><br><span class="line">        responseData.message = <span class="hljs-string">"密码不能为空！"</span>;</span><br><span class="line">        res.json(responseData);</span><br><span class="line">        <span class="hljs-keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-comment">// 向数据库查询，用户是否存在</span></span><br><span class="line">    userModel.findOne(&#123;<span class="hljs-attr">username</span>: username&#125;, (err, user) =&gt; &#123;</span><br><span class="line">        <span class="hljs-comment">// 如果存在该用户</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (user) &#123;</span><br><span class="line">            <span class="hljs-comment">// 验证密码是否正确</span></span><br><span class="line">            <span class="hljs-keyword">if</span> (user.password === password) &#123;</span><br><span class="line">                responseData.message = <span class="hljs-string">"登录成功！"</span>;</span><br><span class="line">                res.json(responseData);</span><br><span class="line">                <span class="hljs-keyword">return</span>;</span><br><span class="line">            &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">                responseData.code = <span class="hljs-number">5</span>;</span><br><span class="line">                responseData.message = <span class="hljs-string">"密码不正确！"</span>;</span><br><span class="line">                res.json(responseData);</span><br><span class="line">                <span class="hljs-keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">            responseData.code = <span class="hljs-number">6</span>;</span><br><span class="line">            responseData.message = <span class="hljs-string">"该用户名不存在！"</span>;</span><br><span class="line">            res.json(responseData);</span><br><span class="line">            <span class="hljs-keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>后端的登录接口完成后，我们在前端的 Js 代码中使用 ajax 向该接口提交数据<br>public/js/main.js 的 ajax 请求方法中添加如下代码：<br><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// 用户登录</span></span><br><span class="line">        $loginBtn.on(<span class="hljs-string">"click"</span>, () =&gt; &#123;</span><br><span class="line">            $.ajax(&#123;</span><br><span class="line">                type: <span class="hljs-string">"post"</span>,</span><br><span class="line">                url: <span class="hljs-string">"/api/user/login"</span>,</span><br><span class="line">                data: &#123;</span><br><span class="line">                    username: $(<span class="hljs-string">"#login [name='username']"</span>).val(),</span><br><span class="line">                    password: $(<span class="hljs-string">"#login [name='password']"</span>).val()</span><br><span class="line">                &#125;,</span><br><span class="line">                dataType: <span class="hljs-string">"json"</span>,</span><br><span class="line">                success: <span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="hljs-keyword">if</span> (result.code) &#123;</span><br><span class="line">                        $warningBox.find(<span class="hljs-string">"span"</span>).html(<span class="hljs-string">"警告："</span> + result.message);</span><br><span class="line">                        $warningBox.addClass(<span class="hljs-string">"alert-danger"</span>)</span><br><span class="line">                        $warningBox.removeClass(<span class="hljs-string">"hide alert-success"</span>);</span><br><span class="line">                    &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">                        <span class="hljs-comment">// 登录成功，隐藏登录界面</span></span><br><span class="line">                        $loginDiv.hide();</span><br><span class="line">                        <span class="hljs-comment">// 显示用户界面</span></span><br><span class="line">                        $(<span class="hljs-string">"#user-info"</span>).removeClass(<span class="hljs-string">"hide"</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure></p>
<p>重启服务器，刷新客户端，我们来进行相应的测试：<br><img src="http://pt2js28ws.bkt.clouddn.com/node_blog_14.gif" alt="登录测试"><br>没发现什么问题，此时博客的用户登录暂时完成。当然这只是简单的登录，并没有使用 cookie 来保存登录状态，保存登录状态会在下一节完成。</p>
<hr>

        </div>
        
            <ul class="post-copyright">
                <li><strong>本文标题：</strong><a href="https://tflin.com/2018/07/23/Node.js + Express + mongodb 的博客项目之模板引擎的配置及用户登录、注册（三）/">Node.js + Express + mongodb 的博客项目之模板引擎的配置及用户登录、注册（三）</a></li>
                <li><strong>本文作者：</strong><a href="https://tflin.com">tflin</a></li>
                <li><strong>本文链接：</strong><a href="https://tflin.com/2018/07/23/Node.js + Express + mongodb 的博客项目之模板引擎的配置及用户登录、注册（三）/">https://tflin.com/2018/07/23/Node.js + Express + mongodb 的博客项目之模板引擎的配置及用户登录、注册（三）/</a></li>
                <li><strong>发布时间：</strong>2018-07-23</li>
                <li><strong>版权声明：</strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明出处！</li>
            </ul>
        
        
        <div class="level is-size-7 is-uppercase">
            <div class="level-start">
                <div class="level-item">
                    <i class="fas fa-tags has-text-grey"></i>&nbsp;
                    <a class="has-link-grey -link" href="/tags/Express/">Express</a>,&nbsp;<a class="has-link-grey -link" href="/tags/Node-js/">Node.js</a>,&nbsp;<a class="has-link-grey -link" href="/tags/实战/">实战</a>
                </div>
            </div>
        </div>
        
        
        
    </div>
</div>





<div class="card card-transparent">
    <div class="level post-navigation is-flex-wrap is-mobile">
        
        <div class="level-start">
            <a class="level level-item has-link-grey  article-nav-prev" href="/2018/07/27/Node.js + Express + mongodb 的博客项目之保持用户登录，区分管理员账户，及用户登出（四）/">
                <i class="level-item fas fa-chevron-left"></i>
                <span class="level-item">Node.js + Express + mongodb 的博客项目之保持用户登录，区分管理员账户，及用户登出（四）</span>
            </a>
        </div>
        
        
        <div class="level-end">
            <a class="level level-item has-link-grey  article-nav-next" href="/2018/07/23/Node.js + Express + mongodb 的博客项目之初始化项目及安装依赖文件（二）/">
                <span class="level-item">Node.js + Express + mongodb 的博客项目之初始化项目及安装依赖文件（二）</span>
                <i class="level-item fas fa-chevron-right"></i>
            </a>
        </div>
        
    </div>
</div>


</div>
                




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left is-sticky">
    
        
 <div class="card widget column-left is-sticky" id="toc">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                目录
            </h3>
            <ul class="menu-list"><li>
        <a class="is-flex" href="#前言">
        <span class="has-mr-6">1</span>
        <span>前言</span>
        </a></li><li>
        <a class="is-flex" href="#模板引擎的配置">
        <span class="has-mr-6">2</span>
        <span>模板引擎的配置</span>
        </a></li><li>
        <a class="is-flex" href="#配置服务器静态资源库">
        <span class="has-mr-6">3</span>
        <span>配置服务器静态资源库</span>
        </a></li><li>
        <a class="is-flex" href="#路由配置">
        <span class="has-mr-6">4</span>
        <span>路由配置</span>
        </a></li><li>
        <a class="is-flex" href="#注册、登录、登出的实现">
        <span class="has-mr-6">5</span>
        <span>注册、登录、登出的实现</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#前台界面设计">
        <span class="has-mr-6">5.1</span>
        <span>前台界面设计</span>
        </a></li><li>
        <a class="is-flex" href="#用户表结构的设计及连接数据库">
        <span class="has-mr-6">5.2</span>
        <span>用户表结构的设计及连接数据库</span>
        </a></li><li>
        <a class="is-flex" href="#前端交互设计">
        <span class="has-mr-6">5.3</span>
        <span>前端交互设计</span>
        </a></li><li>
        <a class="is-flex" href="#用户注册的接口">
        <span class="has-mr-6">5.4</span>
        <span>用户注册的接口</span>
        </a></li><li>
        <a class="is-flex" href="#用户登录的接口">
        <span class="has-mr-6">5.5</span>
        <span>用户登录的接口</span>
        </a></li></ul></li></ul>
        </div>
    </div>
</div>

    
    
        <div class="column-right-shadow is-hidden-widescreen ">
        
        </div>
    
</div>

                
            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/logo.png" alt="Node.js + Express + mongodb 的博客项目之模板引擎的配置及用户登录、注册（三）" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2021 tflin&nbsp;
                Powered by <a href="http://tflin.com/" target="_blank">枫林晚记</a>
                
                </p>
                <p class="is-size-7">本站共计48.7k字</p>
            </div>
            <div class="level-end">
            
                <div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle">
                
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Creative Commons" href="https://creativecommons.org/">
                        
                        <i class="fab fa-creative-commons"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/">
                        
                        <i class="fab fa-creative-commons-by"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Download on GitHub" href="https://github.com/tflins">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                </p>
                
                </div>
            
            </div>
        </div>
    </div>
    <script type="text/javascript" src="https://s9.cnzz.com/z_stat.php?id=1279475949&web_id=1279475949"></script>
    <style>
        a[title="站长统计"] {
            display: none;
        }
    </style>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("zh-CN");</script>

<script>
var IcarusThemeSettings = {
    article: {
        highlight: {
            clipboard: true,
            fold: ''
        }
    }
};
</script>


    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>



    
    
    
    <script src="/js/animation.js"></script>
    

    
    
    
    <script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
    <script src="/js/gallery.js" defer></script>
    

    
    

<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


    
    
<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>

    
    

<a id="back-to-top" title="回到顶端" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>


    
    

    
    
    
    

    
    
    
    
    


<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="想要查找什么..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: '文章',
                PAGES: '页面',
                CATEGORIES: '分类',
                TAGS: '标签',
                UNTITLED: '(无标题)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/z16.model.json"},"display":{"position":"right","width":150,"height":300,"hOffset":40},"mobile":{"show":false}});</script></body>
</html>