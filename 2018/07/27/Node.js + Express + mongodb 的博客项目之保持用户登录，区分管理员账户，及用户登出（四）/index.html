<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><meta name="generator" content="Hexo 3.9.0"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><title>Node.js + Express + mongodb 的博客项目之保持用户登录，区分管理员账户，及用户登出（四） - 枫林晚记</title><meta name="description" content="前言在上一节中，完成了用户的注册与登录，但是并没有保持用户登录，一刷新浏览器登录状态就没有了。所以在本节内容中将实现用户登录状态的保持，同时进行普通用户与博客管理员的区别，并且实现用户登出接口。"><meta name="keywords" content="Node.js,实战,Express"><meta property="og:type" content="article"><meta property="og:title" content="Node.js + Express + mongodb 的博客项目之保持用户登录，区分管理员账户，及用户登出（四）"><meta property="og:url" content="https://tflin.com/2018/07/27/Node.js + Express + mongodb 的博客项目之保持用户登录，区分管理员账户，及用户登出（四）/index.html"><meta property="og:site_name" content="枫林晚记"><meta property="og:description" content="前言在上一节中，完成了用户的注册与登录，但是并没有保持用户登录，一刷新浏览器登录状态就没有了。所以在本节内容中将实现用户登录状态的保持，同时进行普通用户与博客管理员的区别，并且实现用户登出接口。"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://tflin.com/images/og_image.png"><meta property="og:updated_time" content="2021-03-16T02:12:53.644Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Node.js + Express + mongodb 的博客项目之保持用户登录，区分管理员账户，及用户登出（四）"><meta name="twitter:description" content="前言在上一节中，完成了用户的注册与登录，但是并没有保持用户登录，一刷新浏览器登录状态就没有了。所以在本节内容中将实现用户登录状态的保持，同时进行普通用户与博客管理员的区别，并且实现用户登出接口。"><meta name="twitter:image" content="https://tflin.com/images/og_image.png"><link rel="icon" href="/images/favicon.svg"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css"><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/5.4.1/css/all.min.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css"><link rel="stylesheet" href="/css/back-to-top.css"><link rel="stylesheet" href="/css/progressbar.css"><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><link rel="stylesheet" href="/css/style.css"><meta name="referrer" content="no-referrer"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand is-flex-center"><a class="navbar-item navbar-logo" href="/"><img src="/images/logo.png" alt="Node.js + Express + mongodb 的博客项目之保持用户登录，区分管理员账户，及用户登出（四）" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" target="_self" href="/">首页</a> <a class="navbar-item" target="_self" href="/archives/">归档</a> <a class="navbar-item" target="_self" href="/categories/">分类</a> <a class="navbar-item" target="_self" href="/tags/">标签</a> <a class="navbar-item" target="_self" href="/chitchat/">闲言</a> <a class="navbar-item" target="_self" href="http://home.tflin.com/">主页</a> <a class="navbar-item" target="_blank" href="/notes/">笔记</a> <a class="navbar-item" target="_self" href="/about/">关于</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" title="Download on GitHub" href="https://github.com/tflins"><i class="fab fa-github"></i> </a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i> </a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column is-8-tablet is-8-desktop is-9-widescreen has-order-2 column-main"><div class="card"><div class="card-content article"><h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal"><i class="fas fa-angle-double-right"></i>Node.js + Express + mongodb 的博客项目之保持用户登录，区分管理员账户，及用户登出（四）</h1><div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto"><div class="level-left"><time class="level-item has-text-grey" datetime="2018-07-27T08:47:26.000Z"><i class="far fa-calendar-alt">&nbsp;</i>2018-07-27</time> <time class="level-item has-text-grey is-hidden-mobile" datetime="2021-03-16T02:12:53.644Z"><i class="far fa-calendar-check">&nbsp;</i>2021-03-16</time><div class="level-item"><a class="has-link-grey -link" href="/categories/后端/">后端</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/后端/Node-js/">Node.js</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/后端/Node-js/博客实战系列/">博客实战系列</a></div><span class="level-item has-text-grey">13 分钟 读完 (大约 1993 个字)</span></div></div><div class="content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在上一节中，完成了用户的注册与登录，但是并没有保持用户登录，一刷新浏览器登录状态就没有了。所以在本节内容中将实现用户登录状态的保持，同时进行普通用户与博客管理员的区别，并且实现用户登出接口。</p><hr><a id="more"></a><h2 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h2><p>想要维持住登录状态，就得借用 Cookie，Cookie 是服务器给客户端发的一段数据，可以比作通行证，客户端需要保存这段数据，不得随意删除。此后客户端每次访问服务器的时候都要携带上这段数据，这样服务器就能通过这段数据来确认用户的身份了。<br>Cookie 一般有两个作用：<br>第一个就是识别用户身份，比如用户 a 访问了 tlin.com ，那么 tflin.com 的服务器就会给 a 返回一段数据 [uid = 1]，以后 a 不管访问 tflin.com 的任何页面都会携带上 [uid = 1] 这段数据，这样就能根据这段数据进行身份识别了。<br>第二个就是记录历史，也就是比如那些购物网站上的未登录的购物车，同样是借用 Cookie 。当 a 将商品介入购物车时，可以使用 Js 对 Cookie 进行修改，保存相应的记录。这样一来，关闭网页后，即使用户没有登录，再次打开网页，商品依旧安安静静的躺在购物车里。</p><hr><h2 id="保持用户登录"><a href="#保持用户登录" class="headerlink" title="保持用户登录"></a>保持用户登录</h2><p>在本项目中，使用 Cookies 模块来设置 Cookie，这是他的官方文档 <a href="https://www.npmjs.com/package/cookies" target="_blank" rel="noopener">Cookies API</a>。<br>我们先在项目的入口文件 app.js 中引入 Cookies 模块并进行中间件设置，在 app.js 添加如下代码：<br></p><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// 引入cookies模块</span></span><br><span class="line"><span class="hljs-keyword">const</span> Cookies = <span class="hljs-built_in">require</span>(<span class="hljs-string">"cookies"</span>);</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// cookies配置</span></span><br><span class="line">app.use(<span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-comment">// 向请求体对象中新加一个cookies属性，对应当前请求，相应</span></span><br><span class="line">    req.cookies = <span class="hljs-keyword">new</span> Cookies(req, res);</span><br><span class="line">    <span class="hljs-comment">// 给req对象增加一个用户信息的属性，以便所有路由都能读取</span></span><br><span class="line">    req.userInfo = &#123;&#125;;</span><br><span class="line">    <span class="hljs-comment">// 如果客户端中有cookie信息</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (req.cookies.get(<span class="hljs-string">"userInfo"</span>)) &#123;</span><br><span class="line">        <span class="hljs-comment">// 将其解析后存入req.userInfo中</span></span><br><span class="line">        req.userInfo = <span class="hljs-built_in">JSON</span>.parse(req.cookies.get(<span class="hljs-string">"userInfo"</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-comment">// 继续下一个中间件</span></span><br><span class="line">    next();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p></p><p>然后在修改登录接口，在其登录成功的时候设置 cookie 信息，将 routes/api 中的登录接口修改为如下代码：<br></p><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">/*</span></span><br><span class="line"><span class="hljs-comment">    用户登录的接口</span></span><br><span class="line"><span class="hljs-comment">        提交的验证：</span></span><br><span class="line"><span class="hljs-comment">            1.用户名不能为空</span></span><br><span class="line"><span class="hljs-comment">            2.密码不能为空</span></span><br><span class="line"><span class="hljs-comment">        数据库的验证：</span></span><br><span class="line"><span class="hljs-comment">            1.用户名是否存在</span></span><br><span class="line"><span class="hljs-comment">            2.若存在密码是否正确</span></span><br><span class="line"><span class="hljs-comment">*/</span></span><br><span class="line">router.post(<span class="hljs-string">"/user/login"</span>, (req, res, next) =&gt; &#123;</span><br><span class="line">    <span class="hljs-comment">// 用户名</span></span><br><span class="line">    <span class="hljs-keyword">let</span> username = req.body.username;</span><br><span class="line">    <span class="hljs-comment">// 密码</span></span><br><span class="line">    <span class="hljs-keyword">let</span> password = req.body.password;</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(password);</span><br><span class="line">    <span class="hljs-comment">// 用户名不能为空</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (username === <span class="hljs-string">""</span>) &#123;</span><br><span class="line">        responseData.code = <span class="hljs-number">1</span>;</span><br><span class="line">        responseData.message = <span class="hljs-string">"用户名不能为空！"</span>;</span><br><span class="line">        res.json(responseData);</span><br><span class="line">        <span class="hljs-keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-comment">// 密码不能为空</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (password === <span class="hljs-string">""</span>) &#123;</span><br><span class="line">        responseData.code = <span class="hljs-number">2</span>;</span><br><span class="line">        responseData.message = <span class="hljs-string">"密码不能为空！"</span>;</span><br><span class="line">        res.json(responseData);</span><br><span class="line">        <span class="hljs-keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-comment">// 向数据库查询，用户是否存在</span></span><br><span class="line">    userModel.findOne(&#123;<span class="hljs-attr">username</span>: username&#125;, (err, user) =&gt; &#123;</span><br><span class="line">        <span class="hljs-comment">// 如果存在该用户</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (user) &#123;</span><br><span class="line">            <span class="hljs-comment">// 验证密码是否正确</span></span><br><span class="line">            <span class="hljs-keyword">if</span> (user.password === password) &#123;</span><br><span class="line">                responseData.message = <span class="hljs-string">"登录成功！"</span>;</span><br><span class="line">                <span class="hljs-comment">// 在responseData中新建一个用户信息的属性</span></span><br><span class="line">                responseData.userInfo = &#123;</span><br><span class="line">                    username: user.username,</span><br><span class="line">                    userid: user._id</span><br><span class="line">                &#125;;</span><br><span class="line">                <span class="hljs-comment">// 设置cookie信息</span></span><br><span class="line">                req.cookies.set(<span class="hljs-string">"userInfo"</span>, <span class="hljs-built_in">JSON</span>.stringify(responseData.userInfo));</span><br><span class="line">                res.json(responseData);</span><br><span class="line">                <span class="hljs-keyword">return</span>;</span><br><span class="line">            &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">                responseData.code = <span class="hljs-number">5</span>;</span><br><span class="line">                responseData.message = <span class="hljs-string">"密码不正确！"</span>;</span><br><span class="line">                res.json(responseData);</span><br><span class="line">                <span class="hljs-keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">            responseData.code = <span class="hljs-number">6</span>;</span><br><span class="line">            responseData.message = <span class="hljs-string">"该用户名不存在！"</span>;</span><br><span class="line">            res.json(responseData);</span><br><span class="line">            <span class="hljs-keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p></p><p>这个时候我们已经将 cookie 的相关设置配置完成，当在用户登录成功的时候，服务器向客户端发送一个 cookie 信息，并且将 cookie 信息存到 req..userInfo 中，就可以将 req.userInfo 当做数据绑定给模板引擎。模板引擎则根据 req.userInfo 是否存在来判断用户是否已登录。<br>首先先在 /routes/main.js 中将 req.userInfo 分配给模板引擎：<br></p><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// 首页路由配置</span></span><br><span class="line">router.get(<span class="hljs-string">"/"</span>, (req, res) =&gt; &#123;</span><br><span class="line">    <span class="hljs-comment">// 渲染首页模板</span></span><br><span class="line">    res.render(<span class="hljs-string">"main/index"</span>, &#123;</span><br><span class="line">        <span class="hljs-comment">// 给模板引擎绑定数据</span></span><br><span class="line">        userInfo: req.userInfo</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p></p><p>接着就可在前台的页面 views/main/index.ejs 中使用所绑定的数据了，并以此来判断用户是否登录，思路如下：<br>如果 userInfo 存在则渲染用户信息面板，若不存在则渲染登录/注册面板<br></p><figure class="highlight html hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-md-4"</span>&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;<span class="hljs-name">%if</span> (!<span class="hljs-attr">userInfo.userid</span>) &#123;%&gt;</span></span><br><span class="line">      <span class="hljs-comment">&lt;!-- 登录面板 --&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"login"</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>登录<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"input-group"</span>&gt;</span></span><br><span class="line">  			  <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"input-group-addon"</span>&gt;</span>用户<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="line">  			  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"username"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"请输入用户名"</span>&gt;</span></span><br><span class="line">  		  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"input-group"</span>&gt;</span></span><br><span class="line">          <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"input-group-addon"</span>&gt;</span>密码<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="line">          <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"请输入密码"</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-primary form-control"</span>  <span class="hljs-attr">id</span>=<span class="hljs-string">"login-btn"</span>&gt;</span>登录<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"javascripts:;"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-md-offset-4"</span>&gt;</span>没有账号？点击注册<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"alert alert-success alert-dismissable hide"</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"alert"</span>&gt;</span></span><br><span class="line">          <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"close"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span>&gt;</span>×<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="line">          <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>恭喜您操作成功！<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">      <span class="hljs-comment">&lt;!-- 注册面板 --&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"reg"</span>  <span class="hljs-attr">class</span>=<span class="hljs-string">"hide"</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>注册<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"input-group"</span>&gt;</span></span><br><span class="line">  			  <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"input-group-addon"</span>&gt;</span>用户名称<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="line">  			  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"username"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"请输入用户名"</span>&gt;</span></span><br><span class="line">  		  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"input-group"</span>&gt;</span></span><br><span class="line">          <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"input-group-addon"</span>&gt;</span>输入密码<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="line">          <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"请输入密码"</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"input-group"</span>&gt;</span></span><br><span class="line">          <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"input-group-addon"</span>&gt;</span>确认密码<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="line">          <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"repassword"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"请再次输入密码"</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-primary form-control"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"reg-btn"</span>&gt;</span>注册<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"javascripts:;"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-md-offset-4"</span>&gt;</span>已有账号？点击登录<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="line">        <span class="hljs-comment">&lt;!-- 警告框 --&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"alert alert-success alert-dismissable hide"</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"alert"</span>&gt;</span></span><br><span class="line">          <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"close"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span>&gt;</span>×<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="line">          <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>恭喜您操作成功！<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;<span class="hljs-name">%&#125;</span> <span class="hljs-attr">else</span> &#123;%&gt;</span></span><br><span class="line">      <span class="hljs-comment">&lt;!-- 用户面板 --&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"user-info"</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"panel panel-primary"</span>&gt;</span></span><br><span class="line">        	<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"panel-heading"</span>&gt;</span>用户面板<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"panel-body"</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>欢迎，<span class="hljs-tag">&lt;<span class="hljs-name">%=userInfo.username%</span>&gt;</span>！<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span></span><br><span class="line">              <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-danger form-control"</span>&gt;</span>注销<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="line">          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;<span class="hljs-name">%&#125;%</span>&gt;</span></span><br><span class="line">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>改完前台模板，我们的登录的 ajax 请求登录成功后的函数也要进行相应的修改，将登录成功后隐藏登录面板改为刷新页面，因为此时 cookie 已存在，所以刷新页面后，模板会自动渲染出用户信息面板：<br></p><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">success: <span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="hljs-keyword">if</span> (result.code) &#123;</span><br><span class="line">                        $warningBox.find(<span class="hljs-string">"span"</span>).html(<span class="hljs-string">"警告："</span> + result.message);</span><br><span class="line">                        $warningBox.addClass(<span class="hljs-string">"alert-danger"</span>)</span><br><span class="line">                        $warningBox.removeClass(<span class="hljs-string">"hide alert-success"</span>);</span><br><span class="line">                    &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">                        <span class="hljs-comment">// 重新加载页面</span></span><br><span class="line">                        <span class="hljs-built_in">window</span>.location.reload();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br></pre></td></tr></table></figure><p></p><p>最后我们在客户端浏览器中进行测试，发现此时用户登陆后，无论怎么刷新，还是保持着登录状态。<br><img src="http://pt2js28ws.bkt.clouddn.com/node_blog_15.gif" alt="保持用户登录"></p><hr><h2 id="用户登出接口"><a href="#用户登出接口" class="headerlink" title="用户登出接口"></a>用户登出接口</h2><p>用户登出接口则只要将 cookie 清空即可，在 /routes/api.js 中添加如下代码：<br></p><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// 用户登出接口</span></span><br><span class="line">router.get(<span class="hljs-string">"/user/logout"</span>, (req, res, next) =&gt; &#123;</span><br><span class="line">    <span class="hljs-comment">// 将cookie设为null</span></span><br><span class="line">    req.cookies.set(<span class="hljs-string">"userInfo"</span>, <span class="hljs-literal">null</span>);</span><br><span class="line">    res.json(responseData);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p></p><p>然后在前端用 ajax 请求：<br></p><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// 用户登出</span></span><br><span class="line">        $logoutBtn.on(<span class="hljs-string">"click"</span>, () =&gt; &#123;</span><br><span class="line">            $.ajax(&#123;</span><br><span class="line">                type: <span class="hljs-string">"get"</span>,</span><br><span class="line">                url: <span class="hljs-string">"/api/user/logout"</span>,</span><br><span class="line">                success: <span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="hljs-keyword">if</span> (result) &#123;</span><br><span class="line">                        <span class="hljs-built_in">window</span>.location.reload();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure><p></p><p>重启服务器进行测试：<br><img src="http://pt2js28ws.bkt.clouddn.com/node_blog_16.gif" alt="用户登出"><br>到此，用户的登录注册及登出完成。</p><hr><h2 id="管理员与普通用户的区别"><a href="#管理员与普通用户的区别" class="headerlink" title="管理员与普通用户的区别"></a>管理员与普通用户的区别</h2><p>在数据库中，用户集合中有一个字段为 isadmin 这个字段就是是否是管理员，默认为 false，我们可以根据这个字段来判断当前登录的用户是否是管理员。具体步骤是将其从数据库中读取出来然后存放到 req.userInfo 中，与其他页面共享，绑定到模板引擎中，根据 isadmin 的值渲染不同的界面。<br>在项目的入口文件 app.js 先将用户的模型引用进来：<br></p><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// 引用用户模型对象</span></span><br><span class="line"><span class="hljs-keyword">const</span> userModel = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./models/user"</span>);</span><br></pre></td></tr></table></figure><p></p><p>再cookies 配置的中间件中修改为如下代码：<br></p><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// cookies配置</span></span><br><span class="line">app.use(<span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="hljs-comment">// 向请求体对象中新加一个cookies属性，对应当前请求，相应</span></span><br><span class="line">    req.cookies = <span class="hljs-keyword">new</span> Cookies(req, res);</span><br><span class="line">    <span class="hljs-comment">// 给req对象增加一个用户信息的属性，以便所有路由都能读取</span></span><br><span class="line">    req.userInfo = &#123;&#125;;</span><br><span class="line">    <span class="hljs-comment">// 如果客户端中有cookie信息</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (req.cookies.get(<span class="hljs-string">"userInfo"</span>)) &#123;</span><br><span class="line">        <span class="hljs-comment">// 将其解析后存入req.userInfo中</span></span><br><span class="line">        req.userInfo = <span class="hljs-built_in">JSON</span>.parse(req.cookies.get(<span class="hljs-string">"userInfo"</span>));</span><br><span class="line">        <span class="hljs-comment">// 根据用户id从数据库中查询出当前登录用户的信息</span></span><br><span class="line">        userModel.findById(req.userInfo.userid).then(<span class="hljs-function">(<span class="hljs-params">user</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="hljs-comment">// 以此判断当前用户是否为管理员</span></span><br><span class="line">            req.userInfo.isadmin = user.isadmin;</span><br><span class="line">            next();</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">        <span class="hljs-comment">// 继续下一个中间件</span></span><br><span class="line">        next();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p></p><p>然后将博客主页的模板中的用户面板部分修改为如下:<br></p><figure class="highlight html hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">&lt;!-- 用户面板 --&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"user-info"</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"panel panel-primary"</span>&gt;</span></span><br><span class="line">        	<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"panel-heading"</span>&gt;</span>用户面板<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"panel-body"</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">%if</span> (<span class="hljs-attr">userInfo.isadmin</span>) &#123;%&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>欢迎尊贵的管理员，<span class="hljs-tag">&lt;<span class="hljs-name">%=userInfo.username%</span>&gt;</span>!<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span></span><br><span class="line">              <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-danger form-control"</span>&gt;</span>进入控制台<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">%&#125;</span> <span class="hljs-attr">else</span> &#123;%&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>欢迎您，<span class="hljs-tag">&lt;<span class="hljs-name">%=userInfo.username%</span>&gt;</span>！<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">%&#125;%</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span></span><br><span class="line">              <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"logout"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-danger form-control"</span>&gt;</span>注销<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="line">            <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="line">          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="line">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>接着把数据库中的 admin 账户的 isadmin 置为 true 然后重启服务器到客户端浏览器上测试一下：<br><img src="http://pt2js28ws.bkt.clouddn.com/node_blog_17.gif" alt="管理员区分"><br>此时管理员账户与普通用户账户已经区分出来了。</p></div><ul class="post-copyright"><li><strong>本文标题：</strong><a href="https://tflin.com/2018/07/27/Node.js + Express + mongodb 的博客项目之保持用户登录，区分管理员账户，及用户登出（四）/">Node.js + Express + mongodb 的博客项目之保持用户登录，区分管理员账户，及用户登出（四）</a></li><li><strong>本文作者：</strong><a href="https://tflin.com">tflin</a></li><li><strong>本文链接：</strong><a href="https://tflin.com/2018/07/27/Node.js + Express + mongodb 的博客项目之保持用户登录，区分管理员账户，及用户登出（四）/">https://tflin.com/2018/07/27/Node.js + Express + mongodb 的博客项目之保持用户登录，区分管理员账户，及用户登出（四）/</a></li><li><strong>发布时间：</strong>2018-07-27</li><li><strong>版权声明：</strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明出处！</li></ul><div class="level is-size-7 is-uppercase"><div class="level-start"><div class="level-item"><i class="fas fa-tags has-text-grey"></i>&nbsp; <a class="has-link-grey -link" href="/tags/Express/">Express</a>,&nbsp;<a class="has-link-grey -link" href="/tags/Node-js/">Node.js</a>,&nbsp;<a class="has-link-grey -link" href="/tags/实战/">实战</a></div></div></div></div></div><div class="card card-transparent"><div class="level post-navigation is-flex-wrap is-mobile"><div class="level-start"><a class="level level-item has-link-grey article-nav-prev" href="/2018/07/29/Node.js + Express + mongodb 的博客项目之后台管理界面及用户管理（五）/"><i class="level-item fas fa-chevron-left"></i> <span class="level-item">Node.js + Express + mongodb 的博客项目之后台管理界面及用户管理（五）</span></a></div><div class="level-end"><a class="level level-item has-link-grey article-nav-next" href="/2018/07/23/Node.js + Express + mongodb 的博客项目之模板引擎的配置及用户登录、注册（三）/"><span class="level-item">Node.js + Express + mongodb 的博客项目之模板引擎的配置及用户登录、注册（三）</span> <i class="level-item fas fa-chevron-right"></i></a></div></div></div><div class="card"><div class="card-content"><h3 class="title is-5 has-text-weight-normal">PS: 有问题，或者有不同意见，请移步至 <a href="https://github.com/tflins/tflins.github.io/issues" target="_blank">github</a> 提交 issues 进行讨论</h3></div></div></div><div class="column is-4-tablet is-4-desktop is-3-widescreen has-order-1 column-left is-sticky"><div class="card widget column-left is-sticky" id="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="is-flex" href="#前言"><span class="has-mr-6">1</span> <span>前言</span></a></li><li><a class="is-flex" href="#Cookie"><span class="has-mr-6">2</span> <span>Cookie</span></a></li><li><a class="is-flex" href="#保持用户登录"><span class="has-mr-6">3</span> <span>保持用户登录</span></a></li><li><a class="is-flex" href="#用户登出接口"><span class="has-mr-6">4</span> <span>用户登出接口</span></a></li><li><a class="is-flex" href="#管理员与普通用户的区别"><span class="has-mr-6">5</span> <span>管理员与普通用户的区别</span></a></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start has-text-centered-mobile"><a class="footer-logo is-block has-mb-6" href="/"><img src="/images/logo.png" alt="Node.js + Express + mongodb 的博客项目之保持用户登录，区分管理员账户，及用户登出（四）" height="28"></a><p class="is-size-7">&copy; 2021 tflin&nbsp; Powered by <a href="http://tflin.com/" target="_blank">枫林晚记</a></p><p class="is-size-7">本站共计48.7k字</p></div><div class="level-end"><p class="is-size-7" style="text-align:center"><a href="https://beian.miit.gov.cn/" target="_blank">粤ICP备2021076261号-1</a></p></div><div class="level-end"><div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle"><p class="control"><a class="button is-white is-large" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-white is-large" target="_blank" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-white is-large" target="_blank" title="Download on GitHub" href="https://github.com/tflins"><i class="fab fa-github"></i></a></p></div></div></div></div><script type="text/javascript" src="https://s9.cnzz.com/z_stat.php?id=1279475949&web_id=1279475949"></script><style>a[title="站长统计"]{display:none}</style></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("zh-CN")</script><script>var IcarusThemeSettings={article:{highlight:{clipboard:!0,fold:""}}}</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script src="/js/gallery.js" defer></script><div id="outdated"><h6>Your browser is out-of-date!</h6><p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update my browser now</a></p><p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p></div><script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script><script>document.addEventListener("DOMContentLoaded",(function(){outdatedBrowser({bgColor:"#f25648",color:"#ffffff",lowerThan:"flex"})}))</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><script>document.addEventListener("DOMContentLoaded",(function(){MathJax.Hub.Config({"HTML-CSS":{matchFontHeight:!1},SVG:{matchFontHeight:!1},CommonHTML:{matchFontHeight:!1},tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]]}})}))</script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back-to-top.js" defer></script><script src="/js/main.js" defer></script><div class="searchbox ins-search"><div class="searchbox-container ins-search-container"><div class="searchbox-input-wrapper"><input type="text" class="searchbox-input ins-search-input" placeholder="想要查找什么..."> <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span></div><div class="searchbox-result-wrapper ins-section-wrapper"><div class="ins-section-container"></div></div></div></div><script>window.INSIGHT_CONFIG={TRANSLATION:{POSTS:"文章",PAGES:"页面",CATEGORIES:"分类",TAGS:"标签",UNTITLED:"(无标题)"},CONTENT_URL:"/content.json"}</script><script src="/js/insight.js" defer></script><link rel="stylesheet" href="/css/search.css"><link rel="stylesheet" href="/css/insight.css"><script src="//instant.page/5.1.0" type="module" integrity="sha384-by67kQnR+pyfy8yWP4kPO12fHKRLHZPfEsiSXR8u2IKcTdxD805MGUXBzVPnkLHw"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/z16.model.json"},"display":{"position":"right","width":150,"height":300,"hOffset":40},"mobile":{"show":false}});</script></body></html>